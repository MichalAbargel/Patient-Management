{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Michal Abargel\\\\Desktop\\\\FULLSTACK_PROJECTS\\\\PrivateLessones\\\\PL\\\\client\\\\gui\\\\src\\\\components\\\\Calendar\\\\UserCalendar.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useRef, useCallback } from \"react\";\nimport \"devextreme/dist/css/dx.light.css\";\nimport Scheduler, { Editing, Resource } from \"devextreme-react/scheduler\";\nimport StartLive from \"../Teacher/StartLive\";\n//const STATUSES = [\"Pending\", \"Approved\",\"Denied\", \"Done\", \"Cancelled\", \"Available\"];\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst STATUS_COLORS = {\n  Available: \"#09b4e8\",\n  Pending: \"#f0fc7c\",\n  Approved: \"#78eb8f\",\n  Done: \"#097507\",\n  Denied: \"grey\",\n  Cancelled: \"red\"\n};\nconst statuses = [{\n  id: \"Available\",\n  color: STATUS_COLORS[\"Available\"]\n}, {\n  id: \"Approved\",\n  color: STATUS_COLORS[\"Approved\"]\n}, {\n  id: \"Pending\",\n  color: STATUS_COLORS[\"Pending\"]\n}, {\n  id: \"Done\",\n  color: STATUS_COLORS[\"Done\"]\n}, {\n  id: \"Cancelled\",\n  color: STATUS_COLORS[\"Cancelled\"]\n}, {\n  id: \"Denied\",\n  color: STATUS_COLORS[\"Denied\"]\n}];\nconst Legend = () => {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: \"10px\"\n    },\n    children: Object.entries(STATUS_COLORS).map(([status, color]) => /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: \"flex\",\n        alignItems: \"center\",\n        marginBottom: \"5px\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          width: \"20px\",\n          height: \"20px\",\n          backgroundColor: color,\n          marginRight: \"10px\"\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 33,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        children: status\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 41,\n        columnNumber: 11\n      }, this)]\n    }, status, true, {\n      fileName: _jsxFileName,\n      lineNumber: 29,\n      columnNumber: 9\n    }, this))\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 26,\n    columnNumber: 5\n  }, this);\n};\n_c = Legend;\nconst UserCalendar = ({\n  userDetails\n}) => {\n  _s();\n  const [abilities, setAbilities] = useState([]);\n  const scheduler = useRef(null);\n  const [appointments, setAppointments] = useState([]);\n  const [lessonInitialLoadComplete, setlessonInitialLoadComplete] = useState(false);\n  const [lessonAbilityInitialLoadComplete, setlessonAbilityInitialLoadComplete] = useState(false);\n  const [timeAbilityInitialLoadComplete, settimeAbilityInitialLoadComplete] = useState(false);\n  const [user] = useState(userDetails);\n  const isReadOnly = user.user_type === \"student\";\n  const appointmentRender = model => {\n    const {\n      appointmentData\n    } = model;\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [user.user_type !== \"student\" && appointmentData.status && appointmentData.status !== \"Available\" && /*#__PURE__*/_jsxDEV(\"span\", {\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Student name:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 72,\n          columnNumber: 15\n        }, this), \" \", appointmentData.student_name, \" \"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 13\n      }, this), user.user_type !== \"teacher\" && /*#__PURE__*/_jsxDEV(\"span\", {\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Teacher name:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 77,\n          columnNumber: 13\n        }, this), \" \", appointmentData.teacher_name, \" \"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Subject:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 82,\n          columnNumber: 11\n        }, this), \" \", appointmentData.lesson_type_text]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 7\n    }, this);\n  };\n  const fetchLessonsData = async () => {\n    console.log(\"petch lessons\");\n    try {\n      const response = await fetch(`http://localhost:3500/api/lessons/actual/${user.user_id}/${user.user_type}`, {\n        method: \"GET\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      });\n\n      // Update the 'items' state with the fetched data.\n      if (response.status === 200) {\n        const data = await response.json();\n        const currentDate = new Date();\n        const newAppointments = data.map(appointment => {\n          let method = appointment.frontal === 1 ? \"frontal\" : \"zoom\";\n          if (appointment.frontal === 1 && appointment.zoom === 1) {\n            method = \"frontal/zoom\";\n          }\n          const formattedAppointment = {\n            student_name: appointment.student_name,\n            teacher_name: appointment.teacher_name,\n            student_phone: appointment.student_phone,\n            teacher_phone: appointment.teacher_phone,\n            student_email: appointment.student_email,\n            teacher_email: appointment.teacher_email,\n            subject: appointment.subject,\n            startDate: appointment.b_time,\n            endDate: appointment.e_time,\n            isEditable: new Date(appointment.b_time) < currentDate,\n            status: appointment.status,\n            id: `l${appointment.lesson_id}`,\n            paid: appointment.paid_up,\n            cost: appointment.lesson_cost,\n            type: method,\n            subject_type: appointment.subject_type,\n            subject_units: appointment.subject_units,\n            lesson_type_text: `${appointment.subject} ${appointment.subject_units} Units (${appointment.subject_type})`,\n            lesson_ability_id: appointment.lesson_ability_id\n          };\n          return formattedAppointment;\n        });\n        console.log(newAppointments);\n        setAppointments(prevAppointments => [...prevAppointments, ...newAppointments]);\n        setlessonInitialLoadComplete(true);\n      } else {\n        console.error(\"Error fetching data:\");\n      }\n    } catch (error) {\n      console.error(\"Error fetching data:\", error);\n    }\n  };\n  const fetchLessonAbilities = async () => {\n    // Fetch teacher abilities from the server\n    fetch(`http://localhost:3500/api/abilities/${user.user_id}`).then(response => response.json()).then(data => {\n      if (data.length) {\n        setAbilities(data.map(ability => {\n          return {\n            lesson_ability_id: ability.lesson_ability_id,\n            cost: ability.cost,\n            lesson_type_text: `${ability.subject_name} ${ability.units} Units (${ability.type})`,\n            subject: ability.subject_name,\n            units: ability.units,\n            type: ability.type,\n            subject_id: ability.subject_id\n          };\n        })); // Update the state with the fetched data\n\n        if (abilities.length) {\n          setlessonAbilityInitialLoadComplete(true);\n        }\n      } else {\n        alert(\"Please enter Lesson Abilities!\");\n      }\n    }).catch(error => {\n      console.error(\"Error fetching teacher abilities:\", error);\n    });\n  };\n  const fetchTimeAbilities = async () => {\n    try {\n      const response = await fetch(`http://localhost:3500/api/timeAbilities/${user.user_id}`, {\n        method: \"GET\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      });\n      if (response.ok) {\n        const responseData = await response.json();\n        if (responseData.length > 0) {\n          // Use length to check if the array is not empty\n          responseData.forEach(element => {\n            let method = element.frontal === 1 ? \"frontal\" : \"zoom\";\n            if (element.frontal === 1 && element.zoom === 1) {\n              method = \"frontal/zoom\";\n            }\n            element.status = \"Available\";\n            element.startDate = element.start_time;\n            element.endDate = element.end_time;\n            element.id = `t${element.time_ability_id}`;\n            element.type = method;\n            element.cost = element.lesson_cost;\n            element.isEditable = true;\n            element.lesson_type_text = `${element.subject} ${element.units} Units (${element.subject_type})`;\n          });\n          setAppointments(prevAppointments => [...prevAppointments, ...responseData]);\n        }\n        settimeAbilityInitialLoadComplete(true);\n      } else {\n        console.log(\"Failed to load teacherOptions\");\n      }\n    } catch (error) {\n      console.error(\"Error fetching data:\", error);\n    }\n  };\n  useEffect(() => {\n    console.log(\"useEffect in UserCalender\");\n    if (!lessonInitialLoadComplete) {\n      fetchLessonsData();\n    }\n    if (!timeAbilityInitialLoadComplete && user.user_type !== \"student\") {\n      fetchTimeAbilities();\n    }\n    if (!lessonAbilityInitialLoadComplete && user.user_type !== \"student\") {\n      fetchLessonAbilities();\n    }\n  }, []);\n  const doesOverlap = useCallback((appointment1, appointment2, newAppointment = false) => {\n    return (newAppointment || appointment1.id !== appointment2.id) && new Date(appointment1.startDate) < new Date(appointment2.endDate) && new Date(appointment2.startDate) < new Date(appointment1.endDate);\n  }, []);\n  const onAppointmentFormOpening = useCallback(e => {\n    const form = e.form;\n    let formItems = form.option(\"items\");\n    e.popup.option(\"showTitle\", true);\n    e.popup.option(\"title\", e.appointmentData.lesson_type_text ? e.appointmentData.lesson_type_text : \"Appointment Details\");\n    console.log(formItems);\n    // Remove the repeat button or recurrence editor by filtering out the item\n    formItems = formItems.filter(item => item.name !== \"recurrenceGroup\");\n    formItems[0].items.forEach(group => {\n      if (group.items) {\n        group.items = group.items.filter(item => item.dataField !== \"repeat\" && item.dataField !== \"allDay\");\n      }\n    });\n    formItems[0].items.forEach(group => {\n      if (group.itemType === \"empty\") {\n        formItems[0].items.pop(group);\n      }\n    });\n    formItems[0].items.forEach(group => {\n      if (group.itemType === \"empty\") {\n        formItems[0].items.pop(group);\n      }\n    });\n    console.log(formItems);\n    formItems[0].items = formItems[0].items.filter(item => item.dataField !== \"text\" && item.dataField !== \"description\");\n    if (!e.appointmentData.id) {\n      console.log(\"new appointment\");\n      e.appointmentData.isEditable = true;\n      e.appointmentData.status = \"Available\";\n      e.appointmentData.paid = false;\n      e.appointmentData.cost = 0;\n      e.appointmentData.type = \"zoom\";\n      e.appointmentData.student_name = \"\";\n      e.appointmentData.teacher_name = \"\";\n      e.lesson_type_text = \"\";\n      e.appointmentData.id = 1;\n    }\n    formItems[0].items = formItems[0].items.filter(item => item.dataField !== \"student_name\" && item.dataField !== \"teacher_name\" && item.dataField !== \"teacher_phone\" && item.dataField !== \"teacher_email\" && item.dataField !== \"student_phone\" && item.dataField !== \"student_email\");\n    if (e.appointmentData.status !== \"Available\") {\n      if (user.user_type !== \"student\") {\n        formItems[0].items.push({\n          colSpan: 1,\n          label: {\n            text: \"Student Name\"\n          },\n          editorType: \"dxTextBox\",\n          dataField: \"student_name\",\n          editorOptions: {\n            readOnly: true,\n            value: e.appointmentData.student_name\n          }\n        });\n        formItems[0].items.push({\n          colSpan: 1,\n          label: {\n            text: \"Student Phone\"\n          },\n          editorType: \"dxTextBox\",\n          dataField: \"student_phone\",\n          editorOptions: {\n            readOnly: true,\n            value: e.appointmentData.student_phone\n          }\n        });\n        formItems[0].items.push({\n          colSpan: 1,\n          label: {\n            text: \"Student Email\"\n          },\n          editorType: \"dxTextBox\",\n          dataField: \"student_email\",\n          editorOptions: {\n            readOnly: true,\n            value: e.appointmentData.student_email\n          }\n        });\n      }\n      if (user.user_type !== \"teacher\") {\n        formItems[0].items.push({\n          colSpan: 1,\n          label: {\n            text: \"Teacher Name\"\n          },\n          editorType: \"dxTextBox\",\n          dataField: \"teacher_name\",\n          editorOptions: {\n            readOnly: true,\n            value: e.appointmentData.teacher_name\n          }\n        });\n        formItems[0].items.push({\n          colSpan: 1,\n          label: {\n            text: \"Teacher Phone\"\n          },\n          editorType: \"dxTextBox\",\n          dataField: \"teacher_phone\",\n          editorOptions: {\n            readOnly: true,\n            value: e.appointmentData.teacher_phone\n          }\n        });\n        formItems[0].items.push({\n          colSpan: 1,\n          label: {\n            text: \"Teacher Email\"\n          },\n          editorType: \"dxTextBox\",\n          dataField: \"teacher_email\",\n          editorOptions: {\n            readOnly: true,\n            value: e.appointmentData.teacher_email\n          }\n        });\n      }\n    }\n    formItems[0].items = formItems[0].items.filter(item => item.dataField !== \"status\");\n    formItems[0].items.push({\n      colSpan: 1,\n      label: {\n        text: \"Status\"\n      },\n      editorType: \"dxTextBox\",\n      dataField: \"status\",\n      editorOptions: {\n        readOnly: true,\n        value: e.appointmentData.status\n      }\n    });\n    formItems[0].items = formItems[0].items.filter(item => item.dataField !== \"cost\");\n    formItems[0].items.push({\n      colSpan: 1,\n      label: {\n        text: \"Cost\"\n      },\n      editorType: \"dxNumberBox\",\n      dataField: \"cost\",\n      editorOptions: {\n        value: e.appointmentData.cost,\n        readOnly: true\n      }\n    });\n    formItems[0].items = formItems[0].items.filter(item => item.dataField !== \"type\");\n    formItems[0].items.unshift({\n      colSpan: 1,\n      editorType: \"dxSelectBox\",\n      dataField: \"type\",\n      editorOptions: {\n        items: [\"zoom\", \"frontal\", \"frontal/zoom\"],\n        value: e.appointmentData.type\n      }\n    });\n    formItems[0].items = formItems[0].items.filter(item => item.dataField !== \"lesson_ability_id\");\n    if (user.user_type !== \"student\") {\n      formItems[0].items.unshift({\n        colSpan: 1,\n        label: {\n          text: \"Lesson\"\n        },\n        editorType: \"dxSelectBox\",\n        dataField: \"lesson_ability_id\",\n        editorOptions: {\n          items: abilities,\n          displayExpr: \"lesson_type_text\",\n          valueExpr: \"lesson_ability_id\",\n          onValueChanged: args => {\n            const selectedLesson = abilities.find(lesson => lesson.lesson_ability_id === args.value);\n            if (selectedLesson) {\n              e.appointmentData.cost = selectedLesson.cost;\n              e.appointmentData.lesson_type_text = selectedLesson.lesson_type_text;\n              // Directly update the cost editor's value without repainting the entire form\n              const costEditor = form.getEditor(\"cost\");\n              if (costEditor) {\n                costEditor.option(\"value\", selectedLesson.cost);\n              }\n            }\n          }\n        }\n      });\n    } else {\n      formItems[0].items.unshift({\n        colSpan: 1,\n        label: {\n          text: \"Lesson\"\n        },\n        editorType: \"dxTextBox\",\n        dataField: \"lesson_ability_id\",\n        editorOptions: {\n          value: e.appointmentData.lesson_type_text\n        }\n      });\n    }\n    formItems[0].items = formItems[0].items.filter(item => item.dataField !== \"paid\");\n    if (e.appointmentData.id && e.appointmentData.status !== \"Available\") {\n      formItems[0].items.push({\n        colSpan: 1,\n        label: {\n          text: \"Paid Up\"\n        },\n        editorType: \"dxCheckBox\",\n        dataField: \"paid\",\n        editorOptions: {\n          readOnly: (e.appointmentData.status === \"Approved\" || e.appointmentData.status === \"Done\") && user.user_type === \"teacher\" ? false : true,\n          value: e.appointmentData.paid\n        }\n      });\n    }\n    form.option(\"items\", formItems);\n    const updateEditorOptions = items => {\n      items.forEach(item => {\n        if (item.items) {\n          // Recursively handle groups\n          updateEditorOptions(item.items);\n        } else if (item.dataField && item.dataField !== \"status\" && item.dataField !== \"paid\" && item.dataField !== \"cost\") {\n          const currentEditorOptions = item.editorOptions || {};\n          item.editorOptions = {\n            ...currentEditorOptions,\n            readOnly: !e.appointmentData.isEditable\n          };\n        }\n      });\n    };\n    if (e.appointmentData.isEditable === false) {\n      updateEditorOptions(formItems);\n    }\n    form.option(\"items\", [...formItems]);\n    form.repaint();\n    if (user.user_type === \"student\") {\n      const toolbarItems = e.popup.option(\"toolbarItems\");\n      toolbarItems.forEach(item => {\n        if (item.shortcut === \"done\") {\n          item.options.visible = e.appointmentData.isEditable;\n        }\n      });\n      e.popup.option(\"toolbarItems\", toolbarItems);\n      form.repaint();\n    }\n    console.log(\"end appoint data\", e.appointmentData);\n  }, [user.user_type, abilities]);\n  const onAppointmentAdding = useCallback(e => {\n    e.cancel = true;\n    const newAppointment = e.appointmentData;\n    for (let appointment of appointments) {\n      if (doesOverlap(newAppointment, appointment, true)) {\n        e.cancel = true;\n        alert(\"Appointment overlaps with an existing appointment!\");\n        return;\n      }\n    }\n    if (newAppointment.type === \"zoom\") {\n      newAppointment.zoom = true;\n      newAppointment.frontal = false;\n    } else if (newAppointment.type === \"frontal\") {\n      newAppointment.zoom = false;\n      newAppointment.frontal = true;\n    } else if (newAppointment.type === \"frontal/zoom\") {\n      newAppointment.zoom = true;\n      newAppointment.frontal = true;\n    }\n    const selectedLesson = abilities.find(lesson => lesson.lesson_ability_id === newAppointment.lesson_ability_id);\n    newAppointment.status = \"Available\";\n    newAppointment.cost = selectedLesson.cost;\n    newAppointment.subject_name = selectedLesson.subject;\n    newAppointment.subject_type = selectedLesson.type;\n    newAppointment.subject_units = selectedLesson.units;\n    newAppointment.lesson_type_text = selectedLesson.lesson_type_text;\n    newAppointment.startDate = new Date(newAppointment.startDate).toLocaleString(\"sv\").replace(\" \", \"T\");\n    newAppointment.endDate = new Date(newAppointment.endDate).toLocaleString(\"sv\").replace(\" \", \"T\");\n    fetch(`http://localhost:3500/api/timeAbilities`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(newAppointment)\n    }).then(response => {\n      if (!response.ok) {\n        e.cancel = true;\n        throw new Error(`Request failed with status: ${response.status}`);\n      }\n      return response.json();\n    }).then(data => {\n      // Access the insertId from the response\n      newAppointment.id = `t${data.insertId}`;\n      newAppointment.time_ability_id = `t${data.insertId}`;\n      // Add the updated appointment to the state\n      setAppointments(prevAppointments => [...prevAppointments, newAppointment]);\n      // Cancel the original appointment\n      e.cancel = true;\n      console.log(\"all apointments\", appointments);\n    }).catch(error => {\n      // Handle errors here\n      console.error(\"Error:\", error.message);\n      // You can display an error message to the user or perform error-specific actions\n      e.cancel = true;\n    });\n  }, [doesOverlap, appointments, abilities]);\n  const setCancelAppointment = appointmentId => {\n    setAppointments(prevAppointments => prevAppointments.map(appointment => {\n      if (appointment.id === appointmentId) {\n        // Update the status to \"Cancelled\"\n        return {\n          ...appointment,\n          status: \"Cancelled\"\n        };\n      }\n      return appointment;\n    }));\n  };\n  const onAppointmentDeleting = useCallback(async e => {\n    e.cancel = true;\n    console.log(e.appointmentData);\n    if (e.appointmentData.status === \"Done\") {\n      return;\n    } else if (e.appointmentData.status !== \"Available\") {\n      const userConfirmed = window.confirm(\"Are you sure you want to cancel this lesson?\");\n      if (!userConfirmed) {\n        e.cancel = true;\n        return;\n      }\n      try {\n        // Send an HTTP DELETE request to the server to delete the lesson\n        const response = await fetch(`http://localhost:3500/api/lessons/${e.appointmentData.id.toString().slice(1)}`, {\n          method: \"DELETE\",\n          headers: {\n            \"Content-Type\": \"application/json\"\n          }\n        });\n        if (response.status === 200) {\n          // Lesson was successfully deleted\n          console.log(`Lesson ${e.appointmentData.lesson_type_text} has been cancelled.`);\n          alert(`Lesson ${e.appointmentData.lesson_type_text} has been cancelled.`);\n          setCancelAppointment(e.appointmentData.id);\n        } else if (response.status === 404) {\n          // Lesson not found\n          console.log(`Lesson ${e.appointmentData.id} not found.`);\n          e.cancel = true;\n          return;\n        } else {\n          // Handle other error cases\n          console.error(\"An error occurred while cancelling the lesson.\");\n          e.cancel = true;\n          return;\n        }\n      } catch (error) {\n        console.error(\"An error occurred:\", error);\n        e.cancel = true;\n        return;\n      }\n    } else {\n      fetch(`http://localhost:3500/api/timeAbilities/${e.appointmentData.id.toString().slice(1)}`, {\n        method: \"DELETE\"\n      }).then(response => {\n        if (response.status === 200) {\n          // Time ability deleted successfully\n          alert(\"Appointment deleted successfully.\");\n          setAppointments(prevAppointments => {\n            return prevAppointments.filter(a => a.id.toString().slice(1) !== e.appointmentData.id.toString().slice(1));\n          });\n        } else if (response.status === 404) {\n          // Time ability not found\n          console.log(\"Time ability not found.\");\n        } else if (response.status === 403) {\n          // Time ability in use and cannot be deleted\n          alert(\"Time ability is in use and cannot be deleted.\");\n          e.cancel = true;\n        } else {\n          // Handle other errors here\n          alert(\"Time ability is in use and cannot be deleted.\");\n          console.log(\"An error occurred while deleting the time ability.\");\n          e.cancel = true;\n        }\n      }).catch(error => {\n        // Handle network errors here\n        console.error(\"Network error:\", error);\n        console.log(\"An error occurred while communicating with the server.\");\n      });\n    }\n  }, [isReadOnly]);\n  const onAppointmentUpdating = useCallback(e => {\n    if (isReadOnly) {\n      e.cancel = true;\n      return;\n    }\n    if (e.newData.status === \"Available\") {\n      const selectedLesson = abilities.find(lesson => lesson.lesson_ability_id === e.newData.lesson_ability_id);\n      e.newData.cost = selectedLesson.cost;\n      e.newData.subject_name = selectedLesson.subject;\n      e.newData.subject_type = selectedLesson.type;\n      e.newData.subject_units = selectedLesson.units;\n      e.newData.lesson_type_text = selectedLesson.lesson_type_text;\n      for (let appointment of appointments) {\n        if (doesOverlap(e.newData, appointment)) {\n          e.cancel = true;\n          alert(\"Appointment overlaps with an existing appointment!\");\n          return;\n        }\n      }\n      const fullUpdatedAppointment = e.newData;\n      console.log(\"update data\", fullUpdatedAppointment, e.oldData);\n      if (fullUpdatedAppointment.isEditable === false) {\n        e.cancel = true;\n        return;\n      }\n      if (fullUpdatedAppointment.type === \"zoom\") {\n        fullUpdatedAppointment.zoom = true;\n        fullUpdatedAppointment.frontal = false;\n      } else if (fullUpdatedAppointment.type === \"frontal\") {\n        fullUpdatedAppointment.zoom = false;\n        fullUpdatedAppointment.frontal = true;\n      } else if (fullUpdatedAppointment.type === \"frontal/zoom\") {\n        fullUpdatedAppointment.zoom = true;\n        fullUpdatedAppointment.frontal = true;\n      }\n      fullUpdatedAppointment.startDate = new Date(fullUpdatedAppointment.startDate).toLocaleString(\"sv\").replace(\" \", \"T\");\n      fullUpdatedAppointment.endDate = new Date(fullUpdatedAppointment.endDate).toLocaleString(\"sv\").replace(\" \", \"T\");\n      fetch(`http://localhost:3500/api/timeAbilities/${fullUpdatedAppointment.id.toString().slice(1)}`, {\n        method: \"PUT\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(fullUpdatedAppointment)\n      }).then(response => {\n        if (!response.ok) {\n          throw new Error(`Request failed with status: ${response.status}`);\n        }\n        return response.json();\n      }).then(data => {\n        // Handle the successful response here\n        console.log(\"Success:\", data.message);\n\n        // You can perform additional actions or update the UI as needed\n      }).catch(error => {\n        // Handle errors here\n        console.error(\"Error:\", error.message);\n        // You can display an error message to the user or perform error-specific actions\n        e.cancel = true;\n      });\n    } else {\n      if (e.newData.startDate !== e.oldData.startDate || e.newData.endDate !== e.oldData.endDate) {\n        e.cancel = true;\n        return;\n      }\n      for (let appointment of appointments) {\n        if (doesOverlap(e.newData, appointment)) {\n          e.cancel = true;\n          alert(\"Appointment overlaps with an existing appointment!\");\n          return;\n        }\n      }\n      const fullUpdatedAppointment = e.newData;\n      // Make the PUT request using fetch\n      return fetch(`http://localhost:3500/api/lessons/${fullUpdatedAppointment.id.toString().slice(1)}`, {\n        method: \"PUT\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          paid_up: fullUpdatedAppointment.paid,\n          status: fullUpdatedAppointment.status\n        })\n      }).then(response => {\n        if (!response.ok) {\n          throw new Error(`Failed with status: ${response.status}`);\n        }\n        return response.text();\n      }).then(data => {\n        console.log(data);\n      }).catch(error => {\n        console.error(\"Error updating lesson:\", error);\n      });\n    }\n  }, [doesOverlap, appointments, isReadOnly, abilities]);\n  let views = [\"day\", \"week\", \"month\"];\n  const handleAddAppointmentClick = () => {\n    const appointmentData = {};\n    scheduler.current.instance.showAppointmentPopup(appointmentData, true);\n  };\n  const onCellClick = useCallback(e => {\n    if (isReadOnly || new Date(e.cellData.startDate) < new Date()) {\n      e.cancel = true;\n      return;\n    }\n  }, [isReadOnly]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"calendar-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"scheduler\",\n      children: [/*#__PURE__*/_jsxDEV(Scheduler, {\n        ref: scheduler,\n        dataSource: appointments,\n        timeZone: \"Asia/Jerusalem\",\n        defaultCurrentDate: new Date(),\n        defaultCurrentView: \"day\",\n        views: views,\n        height: 600,\n        width: 1300,\n        firstDayOfWeek: 0,\n        startDayHour: 7,\n        endDayHour: 24,\n        showAllDayPanel: false,\n        crossScrollingEnabled: true,\n        cellDuration: 60,\n        appointmentRender: appointmentRender,\n        onAppointmentFormOpening: onAppointmentFormOpening,\n        onAppointmentAdding: onAppointmentAdding,\n        onAppointmentUpdating: onAppointmentUpdating,\n        onAppointmentDeleting: onAppointmentDeleting,\n        onCellClick: onCellClick\n        // groups={groups}\n        ,\n        children: /*#__PURE__*/_jsxDEV(Resource, {\n          fieldExpr: \"status\",\n          dataSource: statuses\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 882,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 859,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Editing, {\n        allowAdding: !isReadOnly,\n        allowDeleting: !isReadOnly\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 884,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 858,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"btn-ctn-sch\",\n      style: {\n        width: \"200px\",\n        padding: \"10px\",\n        borderLeft: \"1px solid #ccc\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(Legend, {\n        className: \"legend\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 894,\n        columnNumber: 9\n      }, this), !isReadOnly && /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"add-btn\",\n        onClick: handleAddAppointmentClick,\n        children: \"Add Appointment\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 896,\n        columnNumber: 11\n      }, this), !isReadOnly && /*#__PURE__*/_jsxDEV(StartLive, {\n        userDEtails: user,\n        subjects: abilities\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 901,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 886,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 857,\n    columnNumber: 5\n  }, this);\n};\n_s(UserCalendar, \"DpXbtopTdlCs+ssWCpZv23jXDF4=\");\n_c2 = UserCalendar;\nexport default UserCalendar;\nvar _c, _c2;\n$RefreshReg$(_c, \"Legend\");\n$RefreshReg$(_c2, \"UserCalendar\");","map":{"version":3,"names":["React","useEffect","useState","useRef","useCallback","Scheduler","Editing","Resource","StartLive","jsxDEV","_jsxDEV","STATUS_COLORS","Available","Pending","Approved","Done","Denied","Cancelled","statuses","id","color","Legend","style","padding","children","Object","entries","map","status","display","alignItems","marginBottom","width","height","backgroundColor","marginRight","fileName","_jsxFileName","lineNumber","columnNumber","_c","UserCalendar","userDetails","_s","abilities","setAbilities","scheduler","appointments","setAppointments","lessonInitialLoadComplete","setlessonInitialLoadComplete","lessonAbilityInitialLoadComplete","setlessonAbilityInitialLoadComplete","timeAbilityInitialLoadComplete","settimeAbilityInitialLoadComplete","user","isReadOnly","user_type","appointmentRender","model","appointmentData","student_name","teacher_name","lesson_type_text","fetchLessonsData","console","log","response","fetch","user_id","method","headers","data","json","currentDate","Date","newAppointments","appointment","frontal","zoom","formattedAppointment","student_phone","teacher_phone","student_email","teacher_email","subject","startDate","b_time","endDate","e_time","isEditable","lesson_id","paid","paid_up","cost","lesson_cost","type","subject_type","subject_units","lesson_ability_id","prevAppointments","error","fetchLessonAbilities","then","length","ability","subject_name","units","subject_id","alert","catch","fetchTimeAbilities","ok","responseData","forEach","element","start_time","end_time","time_ability_id","doesOverlap","appointment1","appointment2","newAppointment","onAppointmentFormOpening","e","form","formItems","option","popup","filter","item","name","items","group","dataField","itemType","pop","push","colSpan","label","text","editorType","editorOptions","readOnly","value","unshift","displayExpr","valueExpr","onValueChanged","args","selectedLesson","find","lesson","costEditor","getEditor","updateEditorOptions","currentEditorOptions","repaint","toolbarItems","shortcut","options","visible","onAppointmentAdding","cancel","toLocaleString","replace","body","JSON","stringify","Error","insertId","message","setCancelAppointment","appointmentId","onAppointmentDeleting","userConfirmed","window","confirm","toString","slice","a","onAppointmentUpdating","newData","fullUpdatedAppointment","oldData","views","handleAddAppointmentClick","current","instance","showAppointmentPopup","onCellClick","cellData","className","ref","dataSource","timeZone","defaultCurrentDate","defaultCurrentView","firstDayOfWeek","startDayHour","endDayHour","showAllDayPanel","crossScrollingEnabled","cellDuration","fieldExpr","allowAdding","allowDeleting","borderLeft","onClick","userDEtails","subjects","_c2","$RefreshReg$"],"sources":["C:/Users/Michal Abargel/Desktop/FULLSTACK_PROJECTS/PrivateLessones/PL/client/gui/src/components/Calendar/UserCalendar.js"],"sourcesContent":["import React, { useEffect, useState, useRef, useCallback } from \"react\";\r\nimport \"devextreme/dist/css/dx.light.css\";\r\nimport Scheduler, { Editing, Resource } from \"devextreme-react/scheduler\";\r\nimport StartLive from \"../Teacher/StartLive\";\r\n//const STATUSES = [\"Pending\", \"Approved\",\"Denied\", \"Done\", \"Cancelled\", \"Available\"];\r\n\r\nconst STATUS_COLORS = {\r\n  Available: \"#09b4e8\",\r\n  Pending: \"#f0fc7c\",\r\n  Approved: \"#78eb8f\",\r\n  Done: \"#097507\",\r\n  Denied: \"grey\",\r\n  Cancelled: \"red\",\r\n};\r\nconst statuses = [\r\n  { id: \"Available\", color: STATUS_COLORS[\"Available\"] },\r\n  { id: \"Approved\", color: STATUS_COLORS[\"Approved\"] },\r\n  { id: \"Pending\", color: STATUS_COLORS[\"Pending\"] },\r\n  { id: \"Done\", color: STATUS_COLORS[\"Done\"] },\r\n  { id: \"Cancelled\", color: STATUS_COLORS[\"Cancelled\"] },\r\n  { id: \"Denied\", color: STATUS_COLORS[\"Denied\"] },\r\n];\r\n\r\nconst Legend = () => {\r\n  return (\r\n    <div style={{ padding: \"10px\" }}>\r\n      {/* <h4>Legend</h4> */}\r\n      {Object.entries(STATUS_COLORS).map(([status, color]) => (\r\n        <div\r\n          key={status}\r\n          style={{ display: \"flex\", alignItems: \"center\", marginBottom: \"5px\" }}\r\n        >\r\n          <div\r\n            style={{\r\n              width: \"20px\",\r\n              height: \"20px\",\r\n              backgroundColor: color,\r\n              marginRight: \"10px\",\r\n            }}\r\n          ></div>\r\n          <span>{status}</span>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst UserCalendar = ({ userDetails }) => {\r\n  const [abilities, setAbilities] = useState([]);\r\n  const scheduler = useRef(null);\r\n  const [appointments, setAppointments] = useState([]);\r\n  const [lessonInitialLoadComplete, setlessonInitialLoadComplete] =\r\n    useState(false);\r\n  const [\r\n    lessonAbilityInitialLoadComplete,\r\n    setlessonAbilityInitialLoadComplete,\r\n  ] = useState(false);\r\n  const [timeAbilityInitialLoadComplete, settimeAbilityInitialLoadComplete] =\r\n    useState(false);\r\n  const [user] = useState(userDetails);\r\n\r\n  const isReadOnly = user.user_type === \"student\";\r\n\r\n  const appointmentRender = (model) => {\r\n    const { appointmentData } = model;\r\n    return (\r\n      <div>\r\n        {user.user_type !== \"student\" &&\r\n          appointmentData.status &&\r\n          appointmentData.status !== \"Available\" && (\r\n            <span>\r\n              <strong>Student name:</strong> {appointmentData.student_name}{\" \"}\r\n            </span>\r\n          )}\r\n        {user.user_type !== \"teacher\" && (\r\n          <span>\r\n            <strong>Teacher name:</strong> {appointmentData.teacher_name}{\" \"}\r\n          </span>\r\n        )}\r\n\r\n        <span>\r\n          <strong>Subject:</strong> {appointmentData.lesson_type_text}\r\n        </span>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const fetchLessonsData = async () => {\r\n    console.log(\"petch lessons\");\r\n    try {\r\n      const response = await fetch(\r\n        `http://localhost:3500/api/lessons/actual/${user.user_id}/${user.user_type}`,\r\n        {\r\n          method: \"GET\",\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n          },\r\n        }\r\n      );\r\n\r\n      // Update the 'items' state with the fetched data.\r\n      if (response.status === 200) {\r\n        const data = await response.json();\r\n        const currentDate = new Date();\r\n\r\n        const newAppointments = data.map((appointment) => {\r\n          let method = appointment.frontal === 1 ? \"frontal\" : \"zoom\";\r\n          if (appointment.frontal === 1 && appointment.zoom === 1) {\r\n            method = \"frontal/zoom\";\r\n          }\r\n          const formattedAppointment = {\r\n            student_name: appointment.student_name,\r\n            teacher_name: appointment.teacher_name,\r\n            student_phone: appointment.student_phone,\r\n            teacher_phone: appointment.teacher_phone,\r\n            student_email: appointment.student_email,\r\n            teacher_email: appointment.teacher_email,\r\n            subject: appointment.subject,\r\n            startDate: appointment.b_time,\r\n            endDate: appointment.e_time,\r\n            isEditable: new Date(appointment.b_time) < currentDate,\r\n            status: appointment.status,\r\n            id: `l${appointment.lesson_id}`,\r\n            paid: appointment.paid_up,\r\n            cost: appointment.lesson_cost,\r\n            type: method,\r\n            subject_type: appointment.subject_type,\r\n            subject_units: appointment.subject_units,\r\n            lesson_type_text: `${appointment.subject} ${appointment.subject_units} Units (${appointment.subject_type})`,\r\n            lesson_ability_id: appointment.lesson_ability_id,\r\n          };\r\n          return formattedAppointment;\r\n        });\r\n        console.log(newAppointments);\r\n        setAppointments((prevAppointments) => [\r\n          ...prevAppointments,\r\n          ...newAppointments,\r\n        ]);\r\n        setlessonInitialLoadComplete(true);\r\n      } else {\r\n        console.error(\"Error fetching data:\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching data:\", error);\r\n    }\r\n  };\r\n  const fetchLessonAbilities = async () => {\r\n    // Fetch teacher abilities from the server\r\n    fetch(`http://localhost:3500/api/abilities/${user.user_id}`)\r\n      .then((response) => response.json())\r\n      .then((data) => {\r\n        if (data.length) {\r\n          setAbilities(\r\n            data.map((ability) => {\r\n              return {\r\n                lesson_ability_id: ability.lesson_ability_id,\r\n                cost: ability.cost,\r\n                lesson_type_text: `${ability.subject_name} ${ability.units} Units (${ability.type})`,\r\n                subject: ability.subject_name,\r\n                units: ability.units,\r\n                type: ability.type,\r\n                subject_id: ability.subject_id,\r\n              };\r\n            })\r\n          ); // Update the state with the fetched data\r\n\r\n          if (abilities.length) {\r\n            setlessonAbilityInitialLoadComplete(true);\r\n          }\r\n        } else {\r\n          alert(\"Please enter Lesson Abilities!\");\r\n        }\r\n      })\r\n      .catch((error) => {\r\n        console.error(\"Error fetching teacher abilities:\", error);\r\n      });\r\n  };\r\n\r\n  const fetchTimeAbilities = async () => {\r\n    try {\r\n      const response = await fetch(\r\n        `http://localhost:3500/api/timeAbilities/${user.user_id}`,\r\n        {\r\n          method: \"GET\",\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n          },\r\n        }\r\n      );\r\n\r\n      if (response.ok) {\r\n        const responseData = await response.json();\r\n        if (responseData.length > 0) {\r\n          // Use length to check if the array is not empty\r\n          responseData.forEach((element) => {\r\n            let method = element.frontal === 1 ? \"frontal\" : \"zoom\";\r\n            if (element.frontal === 1 && element.zoom === 1) {\r\n              method = \"frontal/zoom\";\r\n            }\r\n            element.status = \"Available\";\r\n            element.startDate = element.start_time;\r\n            element.endDate = element.end_time;\r\n            element.id = `t${element.time_ability_id}`;\r\n            element.type = method;\r\n            element.cost = element.lesson_cost;\r\n            element.isEditable = true;\r\n            element.lesson_type_text = `${element.subject} ${element.units} Units (${element.subject_type})`;\r\n          });\r\n          setAppointments((prevAppointments) => [\r\n            ...prevAppointments,\r\n            ...responseData,\r\n          ]);\r\n        }\r\n        settimeAbilityInitialLoadComplete(true);\r\n      } else {\r\n        console.log(\"Failed to load teacherOptions\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching data:\", error);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    console.log(\"useEffect in UserCalender\");\r\n    if (!lessonInitialLoadComplete) {\r\n      fetchLessonsData();\r\n    }\r\n    if (!timeAbilityInitialLoadComplete && user.user_type !== \"student\") {\r\n      fetchTimeAbilities();\r\n    }\r\n    if (!lessonAbilityInitialLoadComplete && user.user_type !== \"student\") {\r\n      fetchLessonAbilities();\r\n    }\r\n  }, []);\r\n\r\n  const doesOverlap = useCallback(\r\n    (appointment1, appointment2, newAppointment = false) => {\r\n      return (\r\n        (newAppointment || appointment1.id !== appointment2.id) &&\r\n        new Date(appointment1.startDate) < new Date(appointment2.endDate) &&\r\n        new Date(appointment2.startDate) < new Date(appointment1.endDate)\r\n      );\r\n    },\r\n    []\r\n  );\r\n\r\n  const onAppointmentFormOpening = useCallback(\r\n    (e) => {\r\n      const form = e.form;\r\n      let formItems = form.option(\"items\");\r\n\r\n      e.popup.option(\"showTitle\", true);\r\n      e.popup.option(\r\n        \"title\",\r\n        e.appointmentData.lesson_type_text\r\n          ? e.appointmentData.lesson_type_text\r\n          : \"Appointment Details\"\r\n      );\r\n      console.log(formItems);\r\n      // Remove the repeat button or recurrence editor by filtering out the item\r\n      formItems = formItems.filter((item) => item.name !== \"recurrenceGroup\");\r\n      formItems[0].items.forEach((group) => {\r\n        if (group.items) {\r\n          group.items = group.items.filter(\r\n            (item) => item.dataField !== \"repeat\" && item.dataField !== \"allDay\"\r\n          );\r\n        }\r\n      });\r\n      formItems[0].items.forEach((group) => {\r\n        if (group.itemType === \"empty\") {\r\n          formItems[0].items.pop(group);\r\n        }\r\n      });\r\n      formItems[0].items.forEach((group) => {\r\n        if (group.itemType === \"empty\") {\r\n          formItems[0].items.pop(group);\r\n        }\r\n      });\r\n      console.log(formItems);\r\n      formItems[0].items = formItems[0].items.filter(\r\n        (item) => item.dataField !== \"text\" && item.dataField !== \"description\"\r\n      );\r\n\r\n      if (!e.appointmentData.id) {\r\n        console.log(\"new appointment\");\r\n        e.appointmentData.isEditable = true;\r\n        e.appointmentData.status = \"Available\";\r\n        e.appointmentData.paid = false;\r\n        e.appointmentData.cost = 0;\r\n        e.appointmentData.type = \"zoom\";\r\n        e.appointmentData.student_name = \"\";\r\n        e.appointmentData.teacher_name = \"\";\r\n        e.lesson_type_text = \"\";\r\n        e.appointmentData.id = 1;\r\n      }\r\n\r\n      formItems[0].items = formItems[0].items.filter(\r\n        (item) =>\r\n          item.dataField !== \"student_name\" &&\r\n          item.dataField !== \"teacher_name\" &&\r\n          item.dataField !== \"teacher_phone\" &&\r\n          item.dataField !== \"teacher_email\" &&\r\n          item.dataField !== \"student_phone\" &&\r\n          item.dataField !== \"student_email\"\r\n      );\r\n\r\n      if (e.appointmentData.status !== \"Available\") {\r\n        if (user.user_type !== \"student\") {\r\n          formItems[0].items.push({\r\n            colSpan: 1,\r\n            label: { text: \"Student Name\" },\r\n            editorType: \"dxTextBox\",\r\n            dataField: \"student_name\",\r\n            editorOptions: {\r\n              readOnly: true,\r\n              value: e.appointmentData.student_name,\r\n            },\r\n          });\r\n          formItems[0].items.push({\r\n            colSpan: 1,\r\n            label: { text: \"Student Phone\" },\r\n            editorType: \"dxTextBox\",\r\n            dataField: \"student_phone\",\r\n            editorOptions: {\r\n              readOnly: true,\r\n              value: e.appointmentData.student_phone,\r\n            },\r\n          });\r\n          formItems[0].items.push({\r\n            colSpan: 1,\r\n            label: { text: \"Student Email\" },\r\n            editorType: \"dxTextBox\",\r\n            dataField: \"student_email\",\r\n            editorOptions: {\r\n              readOnly: true,\r\n              value: e.appointmentData.student_email,\r\n            },\r\n          });\r\n        }\r\n        if (user.user_type !== \"teacher\") {\r\n          formItems[0].items.push({\r\n            colSpan: 1,\r\n            label: { text: \"Teacher Name\" },\r\n            editorType: \"dxTextBox\",\r\n            dataField: \"teacher_name\",\r\n            editorOptions: {\r\n              readOnly: true,\r\n              value: e.appointmentData.teacher_name,\r\n            },\r\n          });\r\n          formItems[0].items.push({\r\n            colSpan: 1,\r\n            label: { text: \"Teacher Phone\" },\r\n            editorType: \"dxTextBox\",\r\n            dataField: \"teacher_phone\",\r\n            editorOptions: {\r\n              readOnly: true,\r\n              value: e.appointmentData.teacher_phone,\r\n            },\r\n          });\r\n          formItems[0].items.push({\r\n            colSpan: 1,\r\n            label: { text: \"Teacher Email\" },\r\n            editorType: \"dxTextBox\",\r\n            dataField: \"teacher_email\",\r\n            editorOptions: {\r\n              readOnly: true,\r\n              value: e.appointmentData.teacher_email,\r\n            },\r\n          });\r\n        }\r\n      }\r\n\r\n      formItems[0].items = formItems[0].items.filter(\r\n        (item) => item.dataField !== \"status\"\r\n      );\r\n      formItems[0].items.push({\r\n        colSpan: 1,\r\n        label: { text: \"Status\" },\r\n        editorType: \"dxTextBox\",\r\n        dataField: \"status\",\r\n        editorOptions: {\r\n          readOnly: true,\r\n          value: e.appointmentData.status,\r\n        },\r\n      });\r\n\r\n      formItems[0].items = formItems[0].items.filter(\r\n        (item) => item.dataField !== \"cost\"\r\n      );\r\n      formItems[0].items.push({\r\n        colSpan: 1,\r\n        label: { text: \"Cost\" },\r\n        editorType: \"dxNumberBox\",\r\n        dataField: \"cost\",\r\n        editorOptions: {\r\n          value: e.appointmentData.cost,\r\n          readOnly: true,\r\n        },\r\n      });\r\n      formItems[0].items = formItems[0].items.filter(\r\n        (item) => item.dataField !== \"type\"\r\n      );\r\n      formItems[0].items.unshift({\r\n        colSpan: 1,\r\n        editorType: \"dxSelectBox\",\r\n        dataField: \"type\",\r\n        editorOptions: {\r\n          items: [\"zoom\", \"frontal\", \"frontal/zoom\"],\r\n          value: e.appointmentData.type,\r\n        },\r\n      });\r\n\r\n      formItems[0].items = formItems[0].items.filter(\r\n        (item) => item.dataField !== \"lesson_ability_id\"\r\n      );\r\n      if (user.user_type !== \"student\") {\r\n        formItems[0].items.unshift({\r\n          colSpan: 1,\r\n          label: { text: \"Lesson\" },\r\n          editorType: \"dxSelectBox\",\r\n          dataField: \"lesson_ability_id\",\r\n          editorOptions: {\r\n            items: abilities,\r\n            displayExpr: \"lesson_type_text\",\r\n            valueExpr: \"lesson_ability_id\",\r\n            onValueChanged: (args) => {\r\n              const selectedLesson = abilities.find(\r\n                (lesson) => lesson.lesson_ability_id === args.value\r\n              );\r\n\r\n              if (selectedLesson) {\r\n                e.appointmentData.cost = selectedLesson.cost;\r\n                e.appointmentData.lesson_type_text =\r\n                  selectedLesson.lesson_type_text;\r\n                // Directly update the cost editor's value without repainting the entire form\r\n                const costEditor = form.getEditor(\"cost\");\r\n                if (costEditor) {\r\n                  costEditor.option(\"value\", selectedLesson.cost);\r\n                }\r\n              }\r\n            },\r\n          },\r\n        });\r\n      } else {\r\n        formItems[0].items.unshift({\r\n          colSpan: 1,\r\n          label: { text: \"Lesson\" },\r\n          editorType: \"dxTextBox\",\r\n          dataField: \"lesson_ability_id\",\r\n          editorOptions: {\r\n            value: e.appointmentData.lesson_type_text,\r\n          },\r\n        });\r\n      }\r\n\r\n      formItems[0].items = formItems[0].items.filter(\r\n        (item) => item.dataField !== \"paid\"\r\n      );\r\n      if (e.appointmentData.id && e.appointmentData.status !== \"Available\") {\r\n        formItems[0].items.push({\r\n          colSpan: 1,\r\n          label: { text: \"Paid Up\" },\r\n          editorType: \"dxCheckBox\",\r\n          dataField: \"paid\",\r\n          editorOptions: {\r\n            readOnly:\r\n              (e.appointmentData.status === \"Approved\" ||\r\n                e.appointmentData.status === \"Done\") &&\r\n              user.user_type === \"teacher\"\r\n                ? false\r\n                : true,\r\n            value: e.appointmentData.paid,\r\n          },\r\n        });\r\n      }\r\n      form.option(\"items\", formItems);\r\n\r\n      const updateEditorOptions = (items) => {\r\n        items.forEach((item) => {\r\n          if (item.items) {\r\n            // Recursively handle groups\r\n            updateEditorOptions(item.items);\r\n          } else if (\r\n            item.dataField &&\r\n            item.dataField !== \"status\" &&\r\n            item.dataField !== \"paid\" &&\r\n            item.dataField !== \"cost\"\r\n          ) {\r\n            const currentEditorOptions = item.editorOptions || {};\r\n            item.editorOptions = {\r\n              ...currentEditorOptions,\r\n              readOnly: !e.appointmentData.isEditable,\r\n            };\r\n          }\r\n        });\r\n      };\r\n      if (e.appointmentData.isEditable === false) {\r\n        updateEditorOptions(formItems);\r\n      }\r\n\r\n      form.option(\"items\", [...formItems]);\r\n      form.repaint();\r\n\r\n      if (user.user_type === \"student\") {\r\n        const toolbarItems = e.popup.option(\"toolbarItems\");\r\n        toolbarItems.forEach((item) => {\r\n          if (item.shortcut === \"done\") {\r\n            item.options.visible = e.appointmentData.isEditable;\r\n          }\r\n        });\r\n        e.popup.option(\"toolbarItems\", toolbarItems);\r\n        form.repaint();\r\n      }\r\n\r\n      console.log(\"end appoint data\", e.appointmentData);\r\n    },\r\n    [user.user_type, abilities]\r\n  );\r\n\r\n  const onAppointmentAdding = useCallback(\r\n    (e) => {\r\n      e.cancel = true;\r\n      const newAppointment = e.appointmentData;\r\n      for (let appointment of appointments) {\r\n        if (doesOverlap(newAppointment, appointment, true)) {\r\n          e.cancel = true;\r\n          alert(\"Appointment overlaps with an existing appointment!\");\r\n          return;\r\n        }\r\n      }\r\n      if (newAppointment.type === \"zoom\") {\r\n        newAppointment.zoom = true;\r\n        newAppointment.frontal = false;\r\n      } else if (newAppointment.type === \"frontal\") {\r\n        newAppointment.zoom = false;\r\n        newAppointment.frontal = true;\r\n      } else if (newAppointment.type === \"frontal/zoom\") {\r\n        newAppointment.zoom = true;\r\n        newAppointment.frontal = true;\r\n      }\r\n      const selectedLesson = abilities.find(\r\n        (lesson) =>\r\n          lesson.lesson_ability_id === newAppointment.lesson_ability_id\r\n      );\r\n      newAppointment.status = \"Available\";\r\n      newAppointment.cost = selectedLesson.cost;\r\n      newAppointment.subject_name = selectedLesson.subject;\r\n      newAppointment.subject_type = selectedLesson.type;\r\n      newAppointment.subject_units = selectedLesson.units;\r\n      newAppointment.lesson_type_text = selectedLesson.lesson_type_text;\r\n      newAppointment.startDate = new Date(newAppointment.startDate)\r\n        .toLocaleString(\"sv\")\r\n        .replace(\" \", \"T\");\r\n      newAppointment.endDate = new Date(newAppointment.endDate)\r\n        .toLocaleString(\"sv\")\r\n        .replace(\" \", \"T\");\r\n\r\n      fetch(`http://localhost:3500/api/timeAbilities`, {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify(newAppointment),\r\n      })\r\n        .then((response) => {\r\n          if (!response.ok) {\r\n            e.cancel = true;\r\n            throw new Error(`Request failed with status: ${response.status}`);\r\n          }\r\n          return response.json();\r\n        })\r\n        .then((data) => {\r\n          // Access the insertId from the response\r\n          newAppointment.id = `t${data.insertId}`;\r\n          newAppointment.time_ability_id = `t${data.insertId}`;\r\n          // Add the updated appointment to the state\r\n          setAppointments((prevAppointments) => [\r\n            ...prevAppointments,\r\n            newAppointment,\r\n          ]);\r\n          // Cancel the original appointment\r\n          e.cancel = true;\r\n          console.log(\"all apointments\", appointments);\r\n        })\r\n        .catch((error) => {\r\n          // Handle errors here\r\n          console.error(\"Error:\", error.message);\r\n          // You can display an error message to the user or perform error-specific actions\r\n          e.cancel = true;\r\n        });\r\n    },\r\n    [doesOverlap, appointments, abilities]\r\n  );\r\n  const setCancelAppointment = (appointmentId) => {\r\n    setAppointments((prevAppointments) =>\r\n      prevAppointments.map((appointment) => {\r\n        if (appointment.id === appointmentId) {\r\n          // Update the status to \"Cancelled\"\r\n          return {\r\n            ...appointment,\r\n            status: \"Cancelled\",\r\n          };\r\n        }\r\n        return appointment;\r\n      })\r\n    );\r\n  };\r\n\r\n  const onAppointmentDeleting = useCallback(\r\n    async (e) => {\r\n      e.cancel = true;\r\n      console.log(e.appointmentData);\r\n      if (e.appointmentData.status === \"Done\") {\r\n        return;\r\n      } else if (e.appointmentData.status !== \"Available\") {\r\n        const userConfirmed = window.confirm(\r\n          \"Are you sure you want to cancel this lesson?\"\r\n        );\r\n        if (!userConfirmed) {\r\n          e.cancel = true;\r\n          return;\r\n        }\r\n        try {\r\n          // Send an HTTP DELETE request to the server to delete the lesson\r\n          const response = await fetch(\r\n            `http://localhost:3500/api/lessons/${e.appointmentData.id\r\n              .toString()\r\n              .slice(1)}`,\r\n            {\r\n              method: \"DELETE\",\r\n              headers: {\r\n                \"Content-Type\": \"application/json\",\r\n              },\r\n            }\r\n          );\r\n\r\n          if (response.status === 200) {\r\n            // Lesson was successfully deleted\r\n            console.log(\r\n              `Lesson ${e.appointmentData.lesson_type_text} has been cancelled.`\r\n            );\r\n            alert(\r\n              `Lesson ${e.appointmentData.lesson_type_text} has been cancelled.`\r\n            );\r\n            setCancelAppointment(e.appointmentData.id);\r\n          } else if (response.status === 404) {\r\n            // Lesson not found\r\n            console.log(`Lesson ${e.appointmentData.id} not found.`);\r\n            e.cancel = true;\r\n            return;\r\n          } else {\r\n            // Handle other error cases\r\n            console.error(\"An error occurred while cancelling the lesson.\");\r\n            e.cancel = true;\r\n            return;\r\n          }\r\n        } catch (error) {\r\n          console.error(\"An error occurred:\", error);\r\n          e.cancel = true;\r\n          return;\r\n        }\r\n      } else {\r\n        fetch(\r\n          `http://localhost:3500/api/timeAbilities/${e.appointmentData.id\r\n            .toString()\r\n            .slice(1)}`,\r\n          {\r\n            method: \"DELETE\",\r\n          }\r\n        )\r\n          .then((response) => {\r\n            if (response.status === 200) {\r\n              // Time ability deleted successfully\r\n              alert(\"Appointment deleted successfully.\");\r\n              setAppointments((prevAppointments) => {\r\n                return prevAppointments.filter(\r\n                  (a) =>\r\n                    a.id.toString().slice(1) !==\r\n                    e.appointmentData.id.toString().slice(1)\r\n                );\r\n              });\r\n            } else if (response.status === 404) {\r\n              // Time ability not found\r\n              console.log(\"Time ability not found.\");\r\n            } else if (response.status === 403) {\r\n              // Time ability in use and cannot be deleted\r\n              alert(\"Time ability is in use and cannot be deleted.\");\r\n              e.cancel = true;\r\n            } else {\r\n              // Handle other errors here\r\n              alert(\"Time ability is in use and cannot be deleted.\");\r\n              console.log(\"An error occurred while deleting the time ability.\");\r\n              e.cancel = true;\r\n            }\r\n          })\r\n          .catch((error) => {\r\n            // Handle network errors here\r\n            console.error(\"Network error:\", error);\r\n            console.log(\r\n              \"An error occurred while communicating with the server.\"\r\n            );\r\n          });\r\n      }\r\n    },\r\n    [isReadOnly]\r\n  );\r\n\r\n  const onAppointmentUpdating = useCallback(\r\n    (e) => {\r\n      if (isReadOnly) {\r\n        e.cancel = true;\r\n        return;\r\n      }\r\n\r\n      if (e.newData.status === \"Available\") {\r\n        const selectedLesson = abilities.find(\r\n          (lesson) => lesson.lesson_ability_id === e.newData.lesson_ability_id\r\n        );\r\n        e.newData.cost = selectedLesson.cost;\r\n        e.newData.subject_name = selectedLesson.subject;\r\n        e.newData.subject_type = selectedLesson.type;\r\n        e.newData.subject_units = selectedLesson.units;\r\n        e.newData.lesson_type_text = selectedLesson.lesson_type_text;\r\n        for (let appointment of appointments) {\r\n          if (doesOverlap(e.newData, appointment)) {\r\n            e.cancel = true;\r\n            alert(\"Appointment overlaps with an existing appointment!\");\r\n            return;\r\n          }\r\n        }\r\n        const fullUpdatedAppointment = e.newData;\r\n        console.log(\"update data\", fullUpdatedAppointment, e.oldData);\r\n        if (fullUpdatedAppointment.isEditable === false) {\r\n          e.cancel = true;\r\n          return;\r\n        }\r\n\r\n        if (fullUpdatedAppointment.type === \"zoom\") {\r\n          fullUpdatedAppointment.zoom = true;\r\n          fullUpdatedAppointment.frontal = false;\r\n        } else if (fullUpdatedAppointment.type === \"frontal\") {\r\n          fullUpdatedAppointment.zoom = false;\r\n          fullUpdatedAppointment.frontal = true;\r\n        } else if (fullUpdatedAppointment.type === \"frontal/zoom\") {\r\n          fullUpdatedAppointment.zoom = true;\r\n          fullUpdatedAppointment.frontal = true;\r\n        }\r\n        fullUpdatedAppointment.startDate = new Date(\r\n          fullUpdatedAppointment.startDate\r\n        )\r\n          .toLocaleString(\"sv\")\r\n          .replace(\" \", \"T\");\r\n        fullUpdatedAppointment.endDate = new Date(\r\n          fullUpdatedAppointment.endDate\r\n        )\r\n          .toLocaleString(\"sv\")\r\n          .replace(\" \", \"T\");\r\n\r\n        fetch(\r\n          `http://localhost:3500/api/timeAbilities/${fullUpdatedAppointment.id\r\n            .toString()\r\n            .slice(1)}`,\r\n          {\r\n            method: \"PUT\",\r\n            headers: {\r\n              \"Content-Type\": \"application/json\",\r\n            },\r\n            body: JSON.stringify(fullUpdatedAppointment),\r\n          }\r\n        )\r\n          .then((response) => {\r\n            if (!response.ok) {\r\n              throw new Error(`Request failed with status: ${response.status}`);\r\n            }\r\n            return response.json();\r\n          })\r\n          .then((data) => {\r\n            // Handle the successful response here\r\n            console.log(\"Success:\", data.message);\r\n\r\n            // You can perform additional actions or update the UI as needed\r\n          })\r\n          .catch((error) => {\r\n            // Handle errors here\r\n            console.error(\"Error:\", error.message);\r\n            // You can display an error message to the user or perform error-specific actions\r\n            e.cancel = true;\r\n          });\r\n      } else {\r\n        if (\r\n          e.newData.startDate !== e.oldData.startDate ||\r\n          e.newData.endDate !== e.oldData.endDate\r\n        ) {\r\n          e.cancel = true;\r\n          return;\r\n        }\r\n        for (let appointment of appointments) {\r\n          if (doesOverlap(e.newData, appointment)) {\r\n            e.cancel = true;\r\n            alert(\"Appointment overlaps with an existing appointment!\");\r\n            return;\r\n          }\r\n        }\r\n        const fullUpdatedAppointment = e.newData;\r\n        // Make the PUT request using fetch\r\n        return fetch(\r\n          `http://localhost:3500/api/lessons/${fullUpdatedAppointment.id\r\n            .toString()\r\n            .slice(1)}`,\r\n          {\r\n            method: \"PUT\",\r\n            headers: {\r\n              \"Content-Type\": \"application/json\",\r\n            },\r\n            body: JSON.stringify({\r\n              paid_up: fullUpdatedAppointment.paid,\r\n              status: fullUpdatedAppointment.status,\r\n            }),\r\n          }\r\n        )\r\n          .then((response) => {\r\n            if (!response.ok) {\r\n              throw new Error(`Failed with status: ${response.status}`);\r\n            }\r\n            return response.text();\r\n          })\r\n          .then((data) => {\r\n            console.log(data);\r\n          })\r\n          .catch((error) => {\r\n            console.error(\"Error updating lesson:\", error);\r\n          });\r\n      }\r\n    },\r\n    [doesOverlap, appointments, isReadOnly, abilities]\r\n  );\r\n\r\n  let views = [\"day\", \"week\", \"month\"];\r\n\r\n  const handleAddAppointmentClick = () => {\r\n    const appointmentData = {};\r\n    scheduler.current.instance.showAppointmentPopup(appointmentData, true);\r\n  };\r\n\r\n  const onCellClick = useCallback(\r\n    (e) => {\r\n      if (isReadOnly || new Date(e.cellData.startDate) < new Date()) {\r\n        e.cancel = true;\r\n        return;\r\n      }\r\n    },\r\n    [isReadOnly]\r\n  );\r\n\r\n  return (\r\n    <div className=\"calendar-container\">\r\n      <div className=\"scheduler\">\r\n        <Scheduler\r\n          ref={scheduler}\r\n          dataSource={appointments}\r\n          timeZone=\"Asia/Jerusalem\"\r\n          defaultCurrentDate={new Date()}\r\n          defaultCurrentView=\"day\"\r\n          views={views}\r\n          height={600}\r\n          width={1300}\r\n          firstDayOfWeek={0}\r\n          startDayHour={7}\r\n          endDayHour={24}\r\n          showAllDayPanel={false}\r\n          crossScrollingEnabled={true}\r\n          cellDuration={60}\r\n          appointmentRender={appointmentRender}\r\n          onAppointmentFormOpening={onAppointmentFormOpening}\r\n          onAppointmentAdding={onAppointmentAdding}\r\n          onAppointmentUpdating={onAppointmentUpdating}\r\n          onAppointmentDeleting={onAppointmentDeleting}\r\n          onCellClick={onCellClick}\r\n          // groups={groups}\r\n        >\r\n          <Resource fieldExpr=\"status\" dataSource={statuses} />\r\n        </Scheduler>\r\n        <Editing allowAdding={!isReadOnly} allowDeleting={!isReadOnly} />\r\n      </div>\r\n      <div\r\n        className=\"btn-ctn-sch\"\r\n        style={{\r\n          width: \"200px\",\r\n          padding: \"10px\",\r\n          borderLeft: \"1px solid #ccc\",\r\n        }}\r\n      >\r\n        <Legend className=\"legend\" />\r\n        {!isReadOnly && (\r\n          <button className=\"add-btn\" onClick={handleAddAppointmentClick}>\r\n            Add Appointment\r\n          </button>\r\n        )}\r\n        {!isReadOnly && (\r\n          <StartLive userDEtails={user} subjects={abilities}></StartLive>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default UserCalendar;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}