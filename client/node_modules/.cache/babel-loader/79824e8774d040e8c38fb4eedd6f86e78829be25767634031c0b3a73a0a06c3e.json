{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/tag_box.js)\r\n * Version: 23.1.5\r\n * Build date: Wed Aug 30 2023\r\n *\r\n * Copyright (c) 2012 - 2023 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport { getOuterWidth, getHeight } from \"../core/utils/size\";\nimport $ from \"../core/renderer\";\nimport devices from \"../core/devices\";\nimport { data as elementData } from \"../core/element_data\";\nimport eventsEngine from \"../events/core/events_engine\";\nimport registerComponent from \"../core/component_registrator\";\nimport { noop, ensureDefined, equalByValue } from \"../core/utils/common\";\nimport { SelectionFilterCreator as FilterCreator } from \"../core/utils/selection_filter\";\nimport { Deferred, when } from \"../core/utils/deferred\";\nimport { createTextElementHiddenCopy } from \"../core/utils/dom\";\nimport { getPublicElement } from \"../core/element\";\nimport { isDefined, isObject, isString } from \"../core/utils/type\";\nimport { hasWindow } from \"../core/utils/window\";\nimport { extend } from \"../core/utils/extend\";\nimport { each } from \"../core/utils/iterator\";\nimport { removeDuplicates, getIntersection } from \"../core/utils/array\";\nimport messageLocalization from \"../localization/message\";\nimport { addNamespace, isCommandKeyPressed, normalizeKeyName } from \"../events/utils/index\";\nimport { name as clickEvent } from \"../events/click\";\nimport caret from \"./text_box/utils.caret\";\nimport { normalizeLoadResult } from \"../data/data_source/utils\";\nimport Guid from \"../core/guid\";\nimport SelectBox from \"./select_box\";\nimport { BindableTemplate } from \"../core/templates/bindable_template\";\nimport { allowScroll } from \"./text_box/utils.scroll\";\nimport errors from \"./widget/ui.errors\";\nvar TAGBOX_TAG_DATA_KEY = \"dxTagData\";\nvar TAGBOX_CLASS = \"dx-tagbox\";\nvar TAGBOX_TAG_CONTAINER_CLASS = \"dx-tag-container\";\nvar TAGBOX_TAG_CLASS = \"dx-tag\";\nvar TAGBOX_MULTI_TAG_CLASS = \"dx-tagbox-multi-tag\";\nvar TAGBOX_CUSTOM_TAG_CLASS = \"dx-tag-custom\";\nvar TAGBOX_TAG_REMOVE_BUTTON_CLASS = \"dx-tag-remove-button\";\nvar TAGBOX_ONLY_SELECT_CLASS = \"dx-tagbox-only-select\";\nvar TAGBOX_SINGLE_LINE_CLASS = \"dx-tagbox-single-line\";\nvar TAGBOX_POPUP_WRAPPER_CLASS = \"dx-tagbox-popup-wrapper\";\nvar TAGBOX_TAG_CONTENT_CLASS = \"dx-tag-content\";\nvar TAGBOX_DEFAULT_FIELD_TEMPLATE_CLASS = \"dx-tagbox-default-template\";\nvar TAGBOX_CUSTOM_FIELD_TEMPLATE_CLASS = \"dx-tagbox-custom-template\";\nvar TEXTEDITOR_INPUT_CONTAINER_CLASS = \"dx-texteditor-input-container\";\nvar TAGBOX_MOUSE_WHEEL_DELTA_MULTIPLIER = -.3;\nvar TagBox = SelectBox.inherit({\n  _supportedKeys: function () {\n    var parent = this.callBase();\n    var sendToList = options => this._list._keyboardHandler(options);\n    var rtlEnabled = this.option(\"rtlEnabled\");\n    return extend({}, parent, {\n      backspace: function (e) {\n        if (!this._isCaretAtTheStart()) {\n          return;\n        }\n        this._processKeyboardEvent(e);\n        this._isTagRemoved = true;\n        var $tagToDelete = this._$focusedTag || this._tagElements().last();\n        if (this._$focusedTag) {\n          this._moveTagFocus(\"prev\", true);\n        }\n        if (0 === $tagToDelete.length) {\n          return;\n        }\n        this._preserveFocusedTag = true;\n        this._removeTagElement($tagToDelete);\n        delete this._preserveFocusedTag;\n      },\n      upArrow: (e, opts) => e.altKey || !this._list ? parent.upArrow.call(this, e) : sendToList(opts),\n      downArrow: (e, opts) => e.altKey || !this._list ? parent.downArrow.call(this, e) : sendToList(opts),\n      del: function (e) {\n        if (!this._$focusedTag || !this._isCaretAtTheStart()) {\n          return;\n        }\n        this._processKeyboardEvent(e);\n        this._isTagRemoved = true;\n        var $tagToDelete = this._$focusedTag;\n        this._moveTagFocus(\"next\", true);\n        this._preserveFocusedTag = true;\n        this._removeTagElement($tagToDelete);\n        delete this._preserveFocusedTag;\n      },\n      enter: function (e, options) {\n        var isListItemFocused = this._list && null !== this._list.option(\"focusedElement\");\n        var isCustomItem = this.option(\"acceptCustomValue\") && !isListItemFocused;\n        if (isCustomItem) {\n          e.preventDefault();\n          \"\" !== this._searchValue() && this._customItemAddedHandler(e);\n          return;\n        }\n        if (this.option(\"opened\")) {\n          this._saveValueChangeEvent(e);\n          sendToList(options);\n          e.preventDefault();\n        }\n      },\n      space: function (e, options) {\n        var isOpened = this.option(\"opened\");\n        var isInputActive = this._shouldRenderSearchEvent();\n        if (isOpened && !isInputActive) {\n          this._saveValueChangeEvent(e);\n          sendToList(options);\n          e.preventDefault();\n        }\n      },\n      leftArrow: function (e) {\n        if (!this._isCaretAtTheStart() || this._isEmpty() || this._isEditable() && rtlEnabled && !this._$focusedTag) {\n          return;\n        }\n        e.preventDefault();\n        var direction = rtlEnabled ? \"next\" : \"prev\";\n        this._moveTagFocus(direction);\n        !this.option(\"multiline\") && this._scrollContainer(direction);\n      },\n      rightArrow: function (e) {\n        if (!this._isCaretAtTheStart() || this._isEmpty() || this._isEditable() && !rtlEnabled && !this._$focusedTag) {\n          return;\n        }\n        e.preventDefault();\n        var direction = rtlEnabled ? \"prev\" : \"next\";\n        this._moveTagFocus(direction);\n        !this.option(\"multiline\") && this._scrollContainer(direction);\n      }\n    });\n  },\n  _processKeyboardEvent: function (e) {\n    e.preventDefault();\n    e.stopPropagation();\n    this._saveValueChangeEvent(e);\n  },\n  _isEmpty: function () {\n    return 0 === this._getValue().length;\n  },\n  _updateTagsContainer: function ($element) {\n    this._$tagsContainer = $element.addClass(TAGBOX_TAG_CONTAINER_CLASS);\n  },\n  _allowSelectItemByTab: function () {\n    return false;\n  },\n  _isCaretAtTheStart: function () {\n    var position = caret(this._input());\n    return 0 === position.start && 0 === position.end;\n  },\n  _updateInputAriaActiveDescendant(id) {\n    this.setAria(\"activedescendant\", id, this._input());\n  },\n  _moveTagFocus: function (direction, clearOnBoundary) {\n    if (!this._$focusedTag) {\n      var tagElements = this._tagElements();\n      this._$focusedTag = \"next\" === direction ? tagElements.first() : tagElements.last();\n      this._toggleFocusClass(true, this._$focusedTag);\n      this._updateInputAriaActiveDescendant(this._$focusedTag.attr(\"id\"));\n      return;\n    }\n    var $nextFocusedTag = this._$focusedTag[direction](\".\".concat(TAGBOX_TAG_CLASS));\n    if ($nextFocusedTag.length > 0) {\n      this._replaceFocusedTag($nextFocusedTag);\n      this._updateInputAriaActiveDescendant($nextFocusedTag.attr(\"id\"));\n    } else if (clearOnBoundary || \"next\" === direction && this._isEditable()) {\n      this._clearTagFocus();\n      this._updateInputAriaActiveDescendant();\n    }\n  },\n  _replaceFocusedTag: function ($nextFocusedTag) {\n    this._toggleFocusClass(false, this._$focusedTag);\n    this._$focusedTag = $nextFocusedTag;\n    this._toggleFocusClass(true, this._$focusedTag);\n  },\n  _clearTagFocus: function () {\n    if (!this._$focusedTag) {\n      return;\n    }\n    this._toggleFocusClass(false, this._$focusedTag);\n    this._updateInputAriaActiveDescendant();\n    delete this._$focusedTag;\n  },\n  _focusClassTarget: function ($element) {\n    if ($element && $element.length && $element[0] !== this._focusTarget()[0]) {\n      return $element;\n    }\n    return this.callBase();\n  },\n  _getLabelContainer: function () {\n    return this._$tagsContainer;\n  },\n  _getFieldElement() {\n    return this._input();\n  },\n  _scrollContainer: function (direction) {\n    if (this.option(\"multiline\") || !hasWindow()) {\n      return;\n    }\n    if (!this._$tagsContainer) {\n      return;\n    }\n    var scrollPosition = this._getScrollPosition(direction);\n    this._$tagsContainer.scrollLeft(scrollPosition);\n  },\n  _getScrollPosition: function (direction) {\n    if (\"start\" === direction || \"end\" === direction) {\n      return this._getBorderPosition(direction);\n    }\n    return this._$focusedTag ? this._getFocusedTagPosition(direction) : this._getBorderPosition(\"end\");\n  },\n  _getBorderPosition: function (direction) {\n    var rtlEnabled = this.option(\"rtlEnabled\");\n    var isScrollLeft = \"end\" === direction ^ rtlEnabled;\n    var scrollSign = rtlEnabled ? -1 : 1;\n    return isScrollLeft ^ !rtlEnabled ? 0 : scrollSign * (this._$tagsContainer.get(0).scrollWidth - getOuterWidth(this._$tagsContainer));\n  },\n  _getFocusedTagPosition: function (direction) {\n    var rtlEnabled = this.option(\"rtlEnabled\");\n    var isScrollLeft = \"next\" === direction ^ rtlEnabled;\n    var {\n      left: scrollOffset\n    } = this._$focusedTag.position();\n    var scrollLeft = this._$tagsContainer.scrollLeft();\n    if (isScrollLeft) {\n      scrollOffset += getOuterWidth(this._$focusedTag, true) - getOuterWidth(this._$tagsContainer);\n    }\n    if (isScrollLeft ^ scrollOffset < 0) {\n      scrollLeft += scrollOffset;\n    }\n    return scrollLeft;\n  },\n  _setNextValue: noop,\n  _getDefaultOptions: function () {\n    return extend(this.callBase(), {\n      value: [],\n      showDropDownButton: false,\n      maxFilterQueryLength: 1500,\n      tagTemplate: \"tag\",\n      selectAllText: messageLocalization.format(\"dxList-selectAll\"),\n      hideSelectedItems: false,\n      selectedItems: [],\n      selectAllMode: \"page\",\n      onSelectAllValueChanged: null,\n      maxDisplayedTags: void 0,\n      showMultiTagOnly: true,\n      onMultiTagPreparing: null,\n      multiline: true,\n      useSubmitBehavior: true\n    });\n  },\n  _init: function () {\n    this.callBase();\n    this._selectedItems = [];\n    this._initSelectAllValueChangedAction();\n  },\n  _initActions: function () {\n    this.callBase();\n    this._initMultiTagPreparingAction();\n  },\n  _initMultiTagPreparingAction: function () {\n    this._multiTagPreparingAction = this._createActionByOption(\"onMultiTagPreparing\", {\n      beforeExecute: function (e) {\n        this._multiTagPreparingHandler(e.args[0]);\n      }.bind(this),\n      excludeValidators: [\"disabled\", \"readOnly\"]\n    });\n  },\n  _multiTagPreparingHandler: function (args) {\n    var {\n      length: selectedCount\n    } = this._getValue();\n    if (!this.option(\"showMultiTagOnly\")) {\n      args.text = messageLocalization.getFormatter(\"dxTagBox-moreSelected\")(selectedCount - this.option(\"maxDisplayedTags\") + 1);\n    } else {\n      args.text = messageLocalization.getFormatter(\"dxTagBox-selected\")(selectedCount);\n    }\n  },\n  _initDynamicTemplates: function () {\n    this.callBase();\n    this._templateManager.addDefaultTemplates({\n      tag: new BindableTemplate(($container, data) => {\n        var _data$text;\n        var $tagContent = $(\"<div>\").addClass(TAGBOX_TAG_CONTENT_CLASS);\n        $(\"<span>\").text(null !== (_data$text = data.text) && void 0 !== _data$text ? _data$text : data).appendTo($tagContent);\n        $(\"<div>\").addClass(TAGBOX_TAG_REMOVE_BUTTON_CLASS).appendTo($tagContent);\n        $container.append($tagContent);\n      }, [\"text\"], this.option(\"integrationOptions.watchMethod\"), {\n        text: this._displayGetter\n      })\n    });\n  },\n  _toggleSubmitElement: function (enabled) {\n    if (enabled) {\n      this._renderSubmitElement();\n      this._setSubmitValue();\n    } else {\n      this._$submitElement && this._$submitElement.remove();\n      delete this._$submitElement;\n    }\n  },\n  _renderSubmitElement: function () {\n    if (!this.option(\"useSubmitBehavior\")) {\n      return;\n    }\n    this._$submitElement = $(\"<select>\").attr({\n      multiple: \"multiple\",\n      \"aria-label\": \"Selected items\"\n    }).css(\"display\", \"none\").appendTo(this.$element());\n  },\n  _setSubmitValue: function () {\n    if (!this.option(\"useSubmitBehavior\")) {\n      return;\n    }\n    var value = this._getValue();\n    var $options = [];\n    for (var i = 0, n = value.length; i < n; i++) {\n      var useDisplayText = this._shouldUseDisplayValue(value[i]);\n      $options.push($(\"<option>\").val(useDisplayText ? this._displayGetter(value[i]) : value[i]).attr(\"selected\", \"selected\"));\n    }\n    this._getSubmitElement().empty().append($options);\n  },\n  _initMarkup: function () {\n    this._tagElementsCache = $();\n    var isSingleLineMode = !this.option(\"multiline\");\n    this.$element().addClass(TAGBOX_CLASS).toggleClass(TAGBOX_ONLY_SELECT_CLASS, !(this.option(\"searchEnabled\") || this.option(\"acceptCustomValue\"))).toggleClass(TAGBOX_SINGLE_LINE_CLASS, isSingleLineMode);\n    this.setAria({\n      role: \"group\",\n      roledescription: \"tagbox\"\n    }, this.$element());\n    this._initTagTemplate();\n    this.callBase();\n  },\n  _getNewLabelId(actualId, newId, shouldRemove) {\n    if (!actualId) {\n      return newId;\n    }\n    if (shouldRemove) {\n      if (actualId === newId) {\n        return;\n      }\n      return actualId.split(\" \").filter(id => id !== newId).join(\" \");\n    }\n    return \"\".concat(actualId, \" \").concat(newId);\n  },\n  _updateElementAria(id, shouldRemove) {\n    var shouldClearLabel = !id;\n    if (shouldClearLabel) {\n      this.setAria(\"labelledby\", void 0, this.$element());\n      return;\n    }\n    var labelId = this.$element().attr(\"aria-labelledby\");\n    var newLabelId = this._getNewLabelId(labelId, id, shouldRemove);\n    this.setAria(\"labelledby\", newLabelId, this.$element());\n  },\n  _render: function () {\n    this.callBase();\n    this._renderTagRemoveAction();\n    this._renderSingleLineScroll();\n    this._scrollContainer(\"start\");\n  },\n  _initTagTemplate: function () {\n    this._tagTemplate = this._getTemplateByOption(\"tagTemplate\");\n  },\n  _renderField: function () {\n    var isDefaultFieldTemplate = !isDefined(this.option(\"fieldTemplate\"));\n    this.$element().toggleClass(TAGBOX_DEFAULT_FIELD_TEMPLATE_CLASS, isDefaultFieldTemplate).toggleClass(TAGBOX_CUSTOM_FIELD_TEMPLATE_CLASS, !isDefaultFieldTemplate);\n    this.callBase();\n  },\n  _renderTagRemoveAction: function () {\n    var tagRemoveAction = this._createAction(this._removeTagHandler.bind(this));\n    var eventName = addNamespace(clickEvent, \"dxTagBoxTagRemove\");\n    eventsEngine.off(this._$tagsContainer, eventName);\n    eventsEngine.on(this._$tagsContainer, eventName, \".\".concat(TAGBOX_TAG_REMOVE_BUTTON_CLASS), event => {\n      tagRemoveAction({\n        event: event\n      });\n    });\n  },\n  _renderSingleLineScroll: function () {\n    var mouseWheelEvent = addNamespace(\"dxmousewheel\", this.NAME);\n    var $element = this.$element();\n    var isMultiline = this.option(\"multiline\");\n    eventsEngine.off($element, mouseWheelEvent);\n    if (\"desktop\" !== devices.real().deviceType) {\n      this._$tagsContainer && this._$tagsContainer.css(\"overflowX\", isMultiline ? \"\" : \"auto\");\n      return;\n    }\n    if (isMultiline) {\n      return;\n    }\n    eventsEngine.on($element, mouseWheelEvent, this._tagContainerMouseWheelHandler.bind(this));\n  },\n  _tagContainerMouseWheelHandler: function (e) {\n    var scrollLeft = this._$tagsContainer.scrollLeft();\n    var delta = e.delta * TAGBOX_MOUSE_WHEEL_DELTA_MULTIPLIER;\n    if (!isCommandKeyPressed(e) && allowScroll(this._$tagsContainer, delta, true)) {\n      this._$tagsContainer.scrollLeft(scrollLeft + delta);\n      return false;\n    }\n  },\n  _renderEvents: function () {\n    this.callBase();\n    var input = this._input();\n    var namespace = addNamespace(\"keydown\", this.NAME);\n    eventsEngine.on(input, namespace, e => {\n      var keyName = normalizeKeyName(e);\n      if (!this._isControlKey(keyName) && this._isEditable()) {\n        this._clearTagFocus();\n      }\n    });\n  },\n  _popupWrapperClass: function () {\n    return this.callBase() + \" \" + TAGBOX_POPUP_WRAPPER_CLASS;\n  },\n  _renderInput: function () {\n    this.callBase();\n    this._renderPreventBlurOnInputClick();\n  },\n  _renderPreventBlurOnInputClick: function () {\n    var eventName = addNamespace(\"mousedown\", \"dxTagBox\");\n    eventsEngine.off(this._inputWrapper(), eventName);\n    eventsEngine.on(this._inputWrapper(), eventName, e => {\n      if (e.target !== this._input()[0] && this._isFocused()) {\n        e.preventDefault();\n      }\n    });\n  },\n  _renderInputValueImpl: function () {\n    return this._renderMultiSelect();\n  },\n  _loadInputValue: function () {\n    return when();\n  },\n  _clearTextValue: function () {\n    this._input().val(\"\");\n    this._toggleEmptinessEventHandler();\n    this.option(\"text\", \"\");\n  },\n  _focusInHandler: function (e) {\n    if (!this._preventNestedFocusEvent(e)) {\n      this._scrollContainer(\"end\");\n    }\n    this.callBase(e);\n  },\n  _renderInputValue: function () {\n    this.option(\"displayValue\", this._searchValue());\n    return this.callBase();\n  },\n  _restoreInputText: function (saveEditingValue) {\n    if (!saveEditingValue) {\n      this._clearTextValue();\n    }\n  },\n  _focusOutHandler: function (e) {\n    if (!this._preventNestedFocusEvent(e)) {\n      this._clearTagFocus();\n      this._scrollContainer(\"start\");\n    }\n    this.callBase(e);\n  },\n  _getFirstPopupElement: function () {\n    return this.option(\"showSelectionControls\") ? this._list._focusTarget() : this.callBase();\n  },\n  _initSelectAllValueChangedAction: function () {\n    this._selectAllValueChangeAction = this._createActionByOption(\"onSelectAllValueChanged\");\n  },\n  _renderList: function () {\n    this.callBase();\n    this._setListDataSourceFilter();\n    if (this.option(\"showSelectionControls\")) {\n      this._list.registerKeyHandler(\"tab\", e => this._popupElementTabHandler(e));\n      this._list.registerKeyHandler(\"escape\", e => this._popupElementEscHandler(e));\n    }\n  },\n  _canListHaveFocus: function () {\n    return \"useButtons\" === this.option(\"applyValueMode\");\n  },\n  _listConfig: function () {\n    var selectionMode = this.option(\"showSelectionControls\") ? \"all\" : \"multiple\";\n    return extend(this.callBase(), {\n      selectionMode: selectionMode,\n      selectAllText: this.option(\"selectAllText\"),\n      onSelectAllValueChanged: _ref => {\n        var {\n          value: value\n        } = _ref;\n        this._selectAllValueChangeAction({\n          value: value\n        });\n      },\n      selectAllMode: this.option(\"selectAllMode\"),\n      selectedItems: this._selectedItems,\n      onFocusedItemChanged: null\n    });\n  },\n  _renderMultiSelect: function () {\n    var d = new Deferred();\n    this._updateTagsContainer(this._$textEditorInputContainer);\n    this._renderInputSize();\n    this._renderTags().done(() => {\n      this._popup && this._popup.refreshPosition();\n      d.resolve();\n    }).fail(d.reject);\n    return d.promise();\n  },\n  _listItemClickHandler: function (e) {\n    !this.option(\"showSelectionControls\") && this._clearTextValue();\n    if (\"useButtons\" === this.option(\"applyValueMode\")) {\n      return;\n    }\n    this.callBase(e);\n    this._saveValueChangeEvent(void 0);\n  },\n  _shouldClearFilter: function () {\n    var shouldClearFilter = this.callBase();\n    var showSelectionControls = this.option(\"showSelectionControls\");\n    return !showSelectionControls && shouldClearFilter;\n  },\n  _renderInputSize: function () {\n    var $input = this._input();\n    var value = $input.val();\n    var isEmptyInput = isString(value) && value;\n    var width = \"\";\n    var size = \"\";\n    var canTypeText = this.option(\"searchEnabled\") || this.option(\"acceptCustomValue\");\n    if (isEmptyInput && canTypeText) {\n      var $calculationElement = createTextElementHiddenCopy($input, value, {\n        includePaddings: true\n      });\n      $calculationElement.insertAfter($input);\n      width = getOuterWidth($calculationElement) + 5;\n      $calculationElement.remove();\n    } else if (!value) {\n      size = 1;\n    }\n    $input.css(\"width\", width);\n    $input.attr(\"size\", size);\n  },\n  _renderInputSubstitution: function () {\n    this.callBase();\n    this._updateWidgetHeight();\n  },\n  _getValue: function () {\n    return this.option(\"value\") || [];\n  },\n  _multiTagRequired: function () {\n    var values = this._getValue();\n    var maxDisplayedTags = this.option(\"maxDisplayedTags\");\n    return isDefined(maxDisplayedTags) && values.length > maxDisplayedTags;\n  },\n  _renderMultiTag: function ($input) {\n    var $tag = $(\"<div>\").addClass(TAGBOX_TAG_CLASS).addClass(TAGBOX_MULTI_TAG_CLASS);\n    var args = {\n      multiTagElement: getPublicElement($tag),\n      selectedItems: this.option(\"selectedItems\")\n    };\n    this._multiTagPreparingAction(args);\n    if (args.cancel) {\n      return false;\n    }\n    $tag.data(TAGBOX_TAG_DATA_KEY, args.text);\n    $tag.insertBefore($input);\n    this._tagTemplate.render({\n      model: args.text,\n      container: getPublicElement($tag)\n    });\n    return $tag;\n  },\n  _getFilter: function (creator) {\n    var dataSourceFilter = this._dataController.filter();\n    var filterExpr = creator.getCombinedFilter(this.option(\"valueExpr\"), dataSourceFilter);\n    var filterQueryLength = encodeURI(JSON.stringify(filterExpr)).length;\n    var maxFilterQueryLength = this.option(\"maxFilterQueryLength\");\n    if (filterQueryLength <= maxFilterQueryLength) {\n      return filterExpr;\n    }\n    errors.log(\"W1019\", maxFilterQueryLength);\n  },\n  _getFilteredItems: function (values) {\n    var _this$_loadFilteredIt, _this$_list;\n    null === (_this$_loadFilteredIt = this._loadFilteredItemsPromise) || void 0 === _this$_loadFilteredIt ? void 0 : _this$_loadFilteredIt.reject();\n    var creator = new FilterCreator(values);\n    var listSelectedItems = null === (_this$_list = this._list) || void 0 === _this$_list ? void 0 : _this$_list.option(\"selectedItems\");\n    var isListItemsLoaded = !!listSelectedItems && this._list._dataController.isLoaded();\n    var selectedItems = listSelectedItems || this.option(\"selectedItems\");\n    var clientFilterFunction = creator.getLocalFilter(this._valueGetter);\n    var filteredItems = selectedItems.filter(clientFilterFunction);\n    var selectedItemsAlreadyLoaded = filteredItems.length === values.length;\n    var d = new Deferred();\n    var dataController = this._dataController;\n    if ((!this._isDataSourceChanged || isListItemsLoaded) && selectedItemsAlreadyLoaded) {\n      return d.resolve(filteredItems).promise();\n    } else {\n      var {\n        customQueryParams: customQueryParams,\n        expand: expand,\n        select: select\n      } = dataController.loadOptions();\n      var filter = this._getFilter(creator);\n      dataController.loadFromStore({\n        filter: filter,\n        customQueryParams: customQueryParams,\n        expand: expand,\n        select: select\n      }).done((data, extra) => {\n        this._isDataSourceChanged = false;\n        if (this._disposed) {\n          d.reject();\n          return;\n        }\n        var {\n          data: items\n        } = normalizeLoadResult(data, extra);\n        var mappedItems = dataController.applyMapFunction(items);\n        d.resolve(mappedItems.filter(clientFilterFunction));\n      }).fail(d.reject);\n      this._loadFilteredItemsPromise = d;\n      return d.promise();\n    }\n  },\n  _createTagsData: function (values, filteredItems) {\n    var items = [];\n    var cache = {};\n    var isValueExprSpecified = \"this\" === this._valueGetterExpr();\n    var filteredValues = {};\n    filteredItems.forEach(filteredItem => {\n      var filteredItemValue = isValueExprSpecified ? JSON.stringify(filteredItem) : this._valueGetter(filteredItem);\n      filteredValues[filteredItemValue] = filteredItem;\n    });\n    var loadItemPromises = [];\n    values.forEach((value, index) => {\n      var currentItem = filteredValues[isValueExprSpecified ? JSON.stringify(value) : value];\n      if (isValueExprSpecified && !isDefined(currentItem)) {\n        loadItemPromises.push(this._loadItem(value, cache).always(item => {\n          var newItem = this._createTagData(items, item, value, index);\n          items.splice(index, 0, newItem);\n        }));\n      } else {\n        var newItem = this._createTagData(items, currentItem, value, index);\n        items.splice(index, 0, newItem);\n      }\n    });\n    var d = new Deferred();\n    when.apply(this, loadItemPromises).always(function () {\n      d.resolve(items);\n    });\n    return d.promise();\n  },\n  _createTagData: function (items, item, value, valueIndex) {\n    if (isDefined(item)) {\n      this._selectedItems.push(item);\n      return item;\n    } else {\n      var selectedItem = this.option(\"selectedItem\");\n      var customItem = this._valueGetter(selectedItem) === value ? selectedItem : value;\n      return customItem;\n    }\n  },\n  _isGroupedData: function () {\n    return this.option(\"grouped\") && !this._dataController.group();\n  },\n  _getItemsByValues: function (values) {\n    var resultItems = [];\n    values.forEach(function (value) {\n      var item = this._getItemFromPlain(value);\n      if (isDefined(item)) {\n        resultItems.push(item);\n      }\n    }.bind(this));\n    return resultItems;\n  },\n  _getFilteredGroupedItems: function (values) {\n    var selectedItems = new Deferred();\n    if (this._filteredGroupedItemsLoadPromise) {\n      this._dataController.cancel(this._filteredGroupedItemsLoadPromise.operationId);\n    }\n    if (!this._dataController.items().length) {\n      this._filteredGroupedItemsLoadPromise = this._dataController.load().done(() => {\n        selectedItems.resolve(this._getItemsByValues(values));\n      }).fail(() => {\n        selectedItems.resolve([]);\n      }).always(() => {\n        this._filteredGroupedItemsLoadPromise = void 0;\n      });\n    } else {\n      selectedItems.resolve(this._getItemsByValues(values));\n    }\n    return selectedItems.promise();\n  },\n  _loadTagsData: function () {\n    var values = this._getValue();\n    var tagData = new Deferred();\n    this._selectedItems = [];\n    var filteredItemsPromise = this._isGroupedData() ? this._getFilteredGroupedItems(values) : this._getFilteredItems(values);\n    filteredItemsPromise.done(filteredItems => {\n      var items = this._createTagsData(values, filteredItems);\n      items.always(function (data) {\n        tagData.resolve(data);\n      });\n    }).fail(tagData.reject.bind(this));\n    return tagData.promise();\n  },\n  _renderTags: function () {\n    var d = new Deferred();\n    var isPlainDataUsed = false;\n    if (this._shouldGetItemsFromPlain(this._valuesToUpdate)) {\n      this._selectedItems = this._getItemsFromPlain(this._valuesToUpdate);\n      if (this._selectedItems.length === this._valuesToUpdate.length) {\n        this._renderTagsImpl(this._selectedItems);\n        isPlainDataUsed = true;\n        d.resolve();\n      }\n    }\n    if (!isPlainDataUsed) {\n      this._loadTagsData().done(items => {\n        if (this._disposed) {\n          d.reject();\n          return;\n        }\n        this._renderTagsImpl(items);\n        d.resolve();\n      }).fail(d.reject);\n    }\n    return d.promise();\n  },\n  _renderTagsImpl: function (items) {\n    this._renderTagsCore(items);\n    this._renderEmptyState();\n    if (!this._preserveFocusedTag) {\n      this._clearTagFocus();\n    }\n  },\n  _shouldGetItemsFromPlain: function (values) {\n    return values && this._dataController.isLoaded() && values.length <= this._getPlainItems().length;\n  },\n  _getItemsFromPlain: function (values) {\n    var selectedItems = this._getSelectedItemsFromList(values);\n    var needFilterPlainItems = 0 === selectedItems.length && values.length > 0 || selectedItems.length < values.length;\n    if (needFilterPlainItems) {\n      var plainItems = this._getPlainItems();\n      selectedItems = this._filterSelectedItems(plainItems, values);\n    }\n    return selectedItems;\n  },\n  _getSelectedItemsFromList: function (values) {\n    var _this$_list2;\n    var listSelectedItems = null === (_this$_list2 = this._list) || void 0 === _this$_list2 ? void 0 : _this$_list2.option(\"selectedItems\");\n    var selectedItems = [];\n    if (values.length === (null === listSelectedItems || void 0 === listSelectedItems ? void 0 : listSelectedItems.length)) {\n      selectedItems = this._filterSelectedItems(listSelectedItems, values);\n    }\n    return selectedItems;\n  },\n  _filterSelectedItems: function (plainItems, values) {\n    var selectedItems = plainItems.filter(dataItem => {\n      var currentValue;\n      for (var i = 0; i < values.length; i++) {\n        currentValue = values[i];\n        if (isObject(currentValue)) {\n          if (this._isValueEquals(dataItem, currentValue)) {\n            return true;\n          }\n        } else if (this._isValueEquals(this._valueGetter(dataItem), currentValue)) {\n          return true;\n        }\n      }\n      return false;\n    }, this);\n    return selectedItems;\n  },\n  _integrateInput: function () {\n    this._isInputReady.resolve();\n    this.callBase();\n    var tagsContainer = this.$element().find(\".\".concat(TEXTEDITOR_INPUT_CONTAINER_CLASS));\n    this._updateTagsContainer(tagsContainer);\n    this._renderTagRemoveAction();\n  },\n  _renderTagsCore: function (items) {\n    var _this$_isInputReady;\n    null === (_this$_isInputReady = this._isInputReady) || void 0 === _this$_isInputReady ? void 0 : _this$_isInputReady.reject();\n    this._isInputReady = new Deferred();\n    this._renderField();\n    this.option(\"selectedItems\", this._selectedItems.slice());\n    this._cleanTags();\n    if (this._input().length > 0) {\n      this._isInputReady.resolve();\n    }\n    when(this._isInputReady).done(() => {\n      this._renderTagsElements(items);\n    });\n  },\n  _renderTagsElements(items) {\n    var $multiTag = this._multiTagRequired() && this._renderMultiTag(this._input());\n    var showMultiTagOnly = this.option(\"showMultiTagOnly\");\n    var maxDisplayedTags = this.option(\"maxDisplayedTags\");\n    items.forEach((item, index) => {\n      if ($multiTag && showMultiTagOnly || $multiTag && !showMultiTagOnly && index - maxDisplayedTags >= -1) {\n        return false;\n      }\n      this._renderTag(item, $multiTag || this._input());\n    });\n    if (this._isFocused()) {\n      this._scrollContainer(\"end\");\n    }\n    this._refreshTagElements();\n  },\n  _cleanTags: function () {\n    if (this._multiTagRequired()) {\n      this._tagElements().remove();\n    } else {\n      var $tags = this._tagElements();\n      var values = this._getValue();\n      each($tags, function (_, tag) {\n        var $tag = $(tag);\n        var tagData = $tag.data(TAGBOX_TAG_DATA_KEY);\n        if (!(null !== values && void 0 !== values && values.includes(tagData))) {\n          $tag.remove();\n        }\n      });\n    }\n    this._updateElementAria();\n  },\n  _renderEmptyState: function () {\n    var isEmpty = !(this._getValue().length || this._selectedItems.length || this._searchValue());\n    this._toggleEmptiness(isEmpty);\n    this._renderDisplayText();\n  },\n  _renderDisplayText: function () {\n    this._renderInputSize();\n  },\n  _refreshTagElements: function () {\n    this._tagElementsCache = this.$element().find(\".\".concat(TAGBOX_TAG_CLASS));\n  },\n  _tagElements: function () {\n    return this._tagElementsCache;\n  },\n  _applyTagTemplate: function (item, $tag) {\n    this._tagTemplate.render({\n      model: item,\n      container: getPublicElement($tag)\n    });\n  },\n  _renderTag: function (item, $input) {\n    var value = this._valueGetter(item);\n    if (!isDefined(value)) {\n      return;\n    }\n    var $tag = this._getTag(value);\n    var displayValue = this._displayGetter(item);\n    var itemModel = this._getItemModel(item, displayValue);\n    if ($tag) {\n      if (isDefined(displayValue)) {\n        $tag.empty();\n        this._applyTagTemplate(itemModel, $tag);\n      }\n      $tag.removeClass(TAGBOX_CUSTOM_TAG_CLASS);\n      this._updateElementAria($tag.attr(\"id\"));\n    } else {\n      var tagId = \"dx-\".concat(new Guid());\n      $tag = this._createTag(value, $input, tagId);\n      if (isDefined(item)) {\n        this._applyTagTemplate(itemModel, $tag);\n      } else {\n        $tag.addClass(TAGBOX_CUSTOM_TAG_CLASS);\n        this._applyTagTemplate(value, $tag);\n      }\n      this._updateElementAria(tagId);\n    }\n  },\n  _getItemModel: function (item, displayValue) {\n    if (isObject(item) && isDefined(displayValue)) {\n      return item;\n    } else {\n      return ensureDefined(displayValue, \"\");\n    }\n  },\n  _getTag: function (value) {\n    var $tags = this._tagElements();\n    var tagsLength = $tags.length;\n    var result = false;\n    for (var i = 0; i < tagsLength; i++) {\n      var $tag = $tags[i];\n      var tagData = elementData($tag, TAGBOX_TAG_DATA_KEY);\n      if (value === tagData || equalByValue(value, tagData)) {\n        result = $($tag);\n        break;\n      }\n    }\n    return result;\n  },\n  _createTag: function (value, $input, tagId) {\n    return $(\"<div>\").attr(\"id\", tagId).addClass(TAGBOX_TAG_CLASS).data(TAGBOX_TAG_DATA_KEY, value).insertBefore($input);\n  },\n  _toggleEmptinessEventHandler: function () {\n    this._toggleEmptiness(!this._getValue().length && !this._searchValue().length);\n  },\n  _customItemAddedHandler: function (e) {\n    this.callBase(e);\n    this._clearTextValue();\n  },\n  _removeTagHandler: function (args) {\n    var e = args.event;\n    e.stopPropagation();\n    this._saveValueChangeEvent(e);\n    var $tag = $(e.target).closest(\".\".concat(TAGBOX_TAG_CLASS));\n    this._removeTagElement($tag);\n  },\n  _removeTagElement: function ($tag) {\n    if ($tag.hasClass(TAGBOX_MULTI_TAG_CLASS)) {\n      if (!this.option(\"showMultiTagOnly\")) {\n        this.option(\"value\", this._getValue().slice(0, this.option(\"maxDisplayedTags\")));\n      } else {\n        this.reset();\n      }\n      return;\n    }\n    var itemValue = $tag.data(TAGBOX_TAG_DATA_KEY);\n    var itemId = $tag.attr(\"id\");\n    this._removeTagWithUpdate(itemValue);\n    this._updateElementAria(itemId, true);\n    this._refreshTagElements();\n  },\n  _updateField: noop,\n  _removeTagWithUpdate: function (itemValue) {\n    var value = this._getValue().slice();\n    this._removeTag(value, itemValue);\n    this.option(\"value\", value);\n    if (0 === value.length) {\n      this._clearTagFocus();\n    }\n  },\n  _getCurrentValue: function () {\n    return this._lastValue();\n  },\n  _selectionChangeHandler: function (e) {\n    if (\"useButtons\" === this.option(\"applyValueMode\")) {\n      return;\n    }\n    var value = this._getValue().slice();\n    each(e.removedItems || [], (_, removedItem) => {\n      this._removeTag(value, this._valueGetter(removedItem));\n    });\n    each(e.addedItems || [], (_, addedItem) => {\n      this._addTag(value, this._valueGetter(addedItem));\n    });\n    this._updateWidgetHeight();\n    if (!equalByValue(this._list.option(\"selectedItemKeys\"), this.option(\"value\"))) {\n      var listSelectionChangeEvent = this._list._getSelectionChangeEvent();\n      listSelectionChangeEvent && this._saveValueChangeEvent(listSelectionChangeEvent);\n      this.option(\"value\", value);\n    }\n    this._list._saveSelectionChangeEvent(void 0);\n  },\n  _removeTag: function (value, item) {\n    var index = this._valueIndex(item, value);\n    if (index >= 0) {\n      value.splice(index, 1);\n    }\n  },\n  _addTag: function (value, item) {\n    var index = this._valueIndex(item);\n    if (index < 0) {\n      value.push(item);\n    }\n  },\n  _fieldRenderData: function () {\n    return this._selectedItems.slice();\n  },\n  _completeSelection: function (value) {\n    if (!this.option(\"showSelectionControls\")) {\n      this._setValue(value);\n    }\n  },\n  _setValue: function (value) {\n    if (null === value) {\n      return;\n    }\n    var useButtons = \"useButtons\" === this.option(\"applyValueMode\");\n    var valueIndex = this._valueIndex(value);\n    var values = (useButtons ? this._list.option(\"selectedItemKeys\") : this._getValue()).slice();\n    if (valueIndex >= 0) {\n      values.splice(valueIndex, 1);\n    } else {\n      values.push(value);\n    }\n    if (\"useButtons\" === this.option(\"applyValueMode\")) {\n      this._list.option(\"selectedItemKeys\", values);\n    } else {\n      this.option(\"value\", values);\n    }\n  },\n  _isSelectedValue: function (value, cache) {\n    return this._valueIndex(value, null, cache) > -1;\n  },\n  _valueIndex: function (value, values, cache) {\n    var result = -1;\n    if (cache && \"object\" !== typeof value) {\n      if (!cache.indexByValues) {\n        cache.indexByValues = {};\n        values = values || this._getValue();\n        values.forEach(function (value, index) {\n          cache.indexByValues[value] = index;\n        });\n      }\n      if (value in cache.indexByValues) {\n        return cache.indexByValues[value];\n      }\n    }\n    values = values || this._getValue();\n    each(values, (index, selectedValue) => {\n      if (this._isValueEquals(value, selectedValue)) {\n        result = index;\n        return false;\n      }\n    });\n    return result;\n  },\n  _lastValue: function () {\n    var values = this._getValue();\n    var lastValue = values[values.length - 1];\n    return null !== lastValue && void 0 !== lastValue ? lastValue : null;\n  },\n  _shouldRenderSearchEvent: function () {\n    return this.option(\"searchEnabled\") || this.option(\"acceptCustomValue\");\n  },\n  _searchHandler: function (e) {\n    if (this.option(\"searchEnabled\") && !!e && !this._isTagRemoved) {\n      this.callBase(arguments);\n      this._setListDataSourceFilter();\n    }\n    this._updateWidgetHeight();\n    delete this._isTagRemoved;\n  },\n  _updateWidgetHeight: function () {\n    var element = this.$element();\n    var originalHeight = getHeight(element);\n    this._renderInputSize();\n    var currentHeight = getHeight(element);\n    if (this._popup && this.option(\"opened\") && this._isEditable() && currentHeight !== originalHeight) {\n      this._popup.repaint();\n    }\n  },\n  _refreshSelected: function () {\n    var _this$_list3;\n    (null === (_this$_list3 = this._list) || void 0 === _this$_list3 ? void 0 : _this$_list3.getDataSource()) && this._list.option(\"selectedItems\", this._selectedItems);\n  },\n  _resetListDataSourceFilter: function () {\n    var dataController = this._dataController;\n    delete this._userFilter;\n    dataController.filter(null);\n    dataController.reload();\n  },\n  _setListDataSourceFilter: function () {\n    if (!this.option(\"hideSelectedItems\") || !this._list) {\n      return;\n    }\n    var dataController = this._dataController;\n    var valueGetterExpr = this._valueGetterExpr();\n    if (isString(valueGetterExpr) && \"this\" !== valueGetterExpr) {\n      var filter = this._dataSourceFilterExpr();\n      if (void 0 === this._userFilter) {\n        this._userFilter = dataController.filter() || null;\n      }\n      this._userFilter && filter.push(this._userFilter);\n      filter.length ? dataController.filter(filter) : dataController.filter(null);\n    } else {\n      dataController.filter(this._dataSourceFilterFunction.bind(this));\n    }\n    dataController.load();\n  },\n  _dataSourceFilterExpr: function () {\n    var filter = [];\n    this._getValue().forEach(value => filter.push([\"!\", [this._valueGetterExpr(), value]]));\n    return filter;\n  },\n  _dataSourceFilterFunction: function (itemData) {\n    var itemValue = this._valueGetter(itemData);\n    var result = true;\n    each(this._getValue(), (index, value) => {\n      if (this._isValueEquals(value, itemValue)) {\n        result = false;\n        return false;\n      }\n    });\n    return result;\n  },\n  _dataSourceChangedHandler: function () {\n    this._isDataSourceChanged = true;\n    this.callBase.apply(this, arguments);\n  },\n  _applyButtonHandler: function (args) {\n    this._saveValueChangeEvent(args.event);\n    this.option(\"value\", this._getSortedListValues());\n    this._clearTextValue();\n    this.callBase();\n    this._cancelSearchIfNeed();\n  },\n  _getSortedListValues: function () {\n    var listValues = this._getListValues();\n    var currentValue = this.option(\"value\") || [];\n    var existedItems = listValues.length ? getIntersection(currentValue, listValues) : [];\n    var newItems = existedItems.length ? removeDuplicates(listValues, currentValue) : listValues;\n    return existedItems.concat(newItems);\n  },\n  _getListValues: function () {\n    if (!this._list) {\n      return [];\n    }\n    return this._getPlainItems(this._list.option(\"selectedItems\")).map(item => this._valueGetter(item));\n  },\n  _setListDataSource: function () {\n    var currentValue = this._getValue();\n    this.callBase();\n    if (currentValue !== this.option(\"value\")) {\n      this.option(\"value\", currentValue);\n    }\n    this._refreshSelected();\n  },\n  _renderOpenedState: function () {\n    this.callBase();\n    if (\"useButtons\" === this.option(\"applyValueMode\") && !this.option(\"opened\")) {\n      this._refreshSelected();\n    }\n  },\n  reset: function () {\n    this._restoreInputText();\n    var defaultValue = this._getDefaultOptions().value;\n    var currentValue = this.option(\"value\");\n    if (defaultValue && 0 === defaultValue.length && currentValue && defaultValue.length === currentValue.length) {\n      return;\n    }\n    this.callBase();\n  },\n  _clean: function () {\n    this.callBase();\n    delete this._defaultTagTemplate;\n    delete this._valuesToUpdate;\n    delete this._tagTemplate;\n  },\n  _getSelectedItemsDifference(newItems, previousItems) {\n    if (!newItems.length) {\n      return {\n        addedItems: [],\n        removedItems: previousItems.slice()\n      };\n    }\n    if (!previousItems.length) {\n      return {\n        addedItems: newItems.slice(),\n        removedItems: []\n      };\n    }\n    var previousItemsValuesMap = previousItems.reduce((map, item) => {\n      var value = this._valueGetter(item);\n      map[value] = item;\n      return map;\n    }, {});\n    var addedItems = [];\n    newItems.forEach(item => {\n      var value = this._valueGetter(item);\n      if (!previousItemsValuesMap[value]) {\n        addedItems.push(item);\n      }\n      delete previousItemsValuesMap[value];\n    });\n    return {\n      addedItems: addedItems,\n      removedItems: Object.values(previousItemsValuesMap)\n    };\n  },\n  _optionChanged: function (args) {\n    var {\n      name: name,\n      value: value,\n      previousValue: previousValue\n    } = args;\n    switch (name) {\n      case \"onSelectAllValueChanged\":\n        this._initSelectAllValueChangedAction();\n        break;\n      case \"onMultiTagPreparing\":\n        this._initMultiTagPreparingAction();\n        this._renderTags();\n        break;\n      case \"hideSelectedItems\":\n        if (value) {\n          this._setListDataSourceFilter();\n        } else {\n          this._resetListDataSourceFilter();\n        }\n        break;\n      case \"useSubmitBehavior\":\n        this._toggleSubmitElement(value);\n        break;\n      case \"displayExpr\":\n        this.callBase(args);\n        this._initTemplates();\n        this._invalidate();\n        break;\n      case \"tagTemplate\":\n        this._initTagTemplate();\n        this._invalidate();\n        break;\n      case \"selectAllText\":\n        this._setListOption(\"selectAllText\", this.option(\"selectAllText\"));\n        break;\n      case \"readOnly\":\n      case \"disabled\":\n        this.callBase(args);\n        !value && this._refreshEvents();\n        break;\n      case \"value\":\n        this._valuesToUpdate = value;\n        this.callBase(args);\n        this._valuesToUpdate = void 0;\n        this._setListDataSourceFilter();\n        break;\n      case \"maxDisplayedTags\":\n      case \"showMultiTagOnly\":\n        this._renderTags();\n        break;\n      case \"selectAllMode\":\n        this._setListOption(name, value);\n        break;\n      case \"selectedItem\":\n        break;\n      case \"selectedItems\":\n        this._selectionChangedAction(this._getSelectedItemsDifference(value, previousValue));\n        break;\n      case \"multiline\":\n        this.$element().toggleClass(TAGBOX_SINGLE_LINE_CLASS, !value);\n        this._renderSingleLineScroll();\n        break;\n      case \"maxFilterQueryLength\":\n        break;\n      default:\n        this.callBase(args);\n    }\n  },\n  _getActualSearchValue: function () {\n    return this.callBase() || this._searchValue();\n  },\n  _popupHidingHandler: function () {\n    this.callBase();\n    this._clearFilter();\n  }\n});\nregisterComponent(\"dxTagBox\", TagBox);\nexport default TagBox;","map":{"version":3,"names":["getOuterWidth","getHeight","$","devices","data","elementData","eventsEngine","registerComponent","noop","ensureDefined","equalByValue","SelectionFilterCreator","FilterCreator","Deferred","when","createTextElementHiddenCopy","getPublicElement","isDefined","isObject","isString","hasWindow","extend","each","removeDuplicates","getIntersection","messageLocalization","addNamespace","isCommandKeyPressed","normalizeKeyName","name","clickEvent","caret","normalizeLoadResult","Guid","SelectBox","BindableTemplate","allowScroll","errors","TAGBOX_TAG_DATA_KEY","TAGBOX_CLASS","TAGBOX_TAG_CONTAINER_CLASS","TAGBOX_TAG_CLASS","TAGBOX_MULTI_TAG_CLASS","TAGBOX_CUSTOM_TAG_CLASS","TAGBOX_TAG_REMOVE_BUTTON_CLASS","TAGBOX_ONLY_SELECT_CLASS","TAGBOX_SINGLE_LINE_CLASS","TAGBOX_POPUP_WRAPPER_CLASS","TAGBOX_TAG_CONTENT_CLASS","TAGBOX_DEFAULT_FIELD_TEMPLATE_CLASS","TAGBOX_CUSTOM_FIELD_TEMPLATE_CLASS","TEXTEDITOR_INPUT_CONTAINER_CLASS","TAGBOX_MOUSE_WHEEL_DELTA_MULTIPLIER","TagBox","inherit","_supportedKeys","parent","callBase","sendToList","options","_list","_keyboardHandler","rtlEnabled","option","backspace","e","_isCaretAtTheStart","_processKeyboardEvent","_isTagRemoved","$tagToDelete","_$focusedTag","_tagElements","last","_moveTagFocus","length","_preserveFocusedTag","_removeTagElement","upArrow","opts","altKey","call","downArrow","del","enter","isListItemFocused","isCustomItem","preventDefault","_searchValue","_customItemAddedHandler","_saveValueChangeEvent","space","isOpened","isInputActive","_shouldRenderSearchEvent","leftArrow","_isEmpty","_isEditable","direction","_scrollContainer","rightArrow","stopPropagation","_getValue","_updateTagsContainer","$element","_$tagsContainer","addClass","_allowSelectItemByTab","position","_input","start","end","_updateInputAriaActiveDescendant","id","setAria","clearOnBoundary","tagElements","first","_toggleFocusClass","attr","$nextFocusedTag","concat","_replaceFocusedTag","_clearTagFocus","_focusClassTarget","_focusTarget","_getLabelContainer","_getFieldElement","scrollPosition","_getScrollPosition","scrollLeft","_getBorderPosition","_getFocusedTagPosition","isScrollLeft","scrollSign","get","scrollWidth","left","scrollOffset","_setNextValue","_getDefaultOptions","value","showDropDownButton","maxFilterQueryLength","tagTemplate","selectAllText","format","hideSelectedItems","selectedItems","selectAllMode","onSelectAllValueChanged","maxDisplayedTags","showMultiTagOnly","onMultiTagPreparing","multiline","useSubmitBehavior","_init","_selectedItems","_initSelectAllValueChangedAction","_initActions","_initMultiTagPreparingAction","_multiTagPreparingAction","_createActionByOption","beforeExecute","_multiTagPreparingHandler","args","bind","excludeValidators","selectedCount","text","getFormatter","_initDynamicTemplates","_templateManager","addDefaultTemplates","tag","$container","_data$text","$tagContent","appendTo","append","_displayGetter","_toggleSubmitElement","enabled","_renderSubmitElement","_setSubmitValue","_$submitElement","remove","multiple","css","$options","i","n","useDisplayText","_shouldUseDisplayValue","push","val","_getSubmitElement","empty","_initMarkup","_tagElementsCache","isSingleLineMode","toggleClass","role","roledescription","_initTagTemplate","_getNewLabelId","actualId","newId","shouldRemove","split","filter","join","_updateElementAria","shouldClearLabel","labelId","newLabelId","_render","_renderTagRemoveAction","_renderSingleLineScroll","_tagTemplate","_getTemplateByOption","_renderField","isDefaultFieldTemplate","tagRemoveAction","_createAction","_removeTagHandler","eventName","off","on","event","mouseWheelEvent","NAME","isMultiline","real","deviceType","_tagContainerMouseWheelHandler","delta","_renderEvents","input","namespace","keyName","_isControlKey","_popupWrapperClass","_renderInput","_renderPreventBlurOnInputClick","_inputWrapper","target","_isFocused","_renderInputValueImpl","_renderMultiSelect","_loadInputValue","_clearTextValue","_toggleEmptinessEventHandler","_focusInHandler","_preventNestedFocusEvent","_renderInputValue","_restoreInputText","saveEditingValue","_focusOutHandler","_getFirstPopupElement","_selectAllValueChangeAction","_renderList","_setListDataSourceFilter","registerKeyHandler","_popupElementTabHandler","_popupElementEscHandler","_canListHaveFocus","_listConfig","selectionMode","_ref","onFocusedItemChanged","d","_$textEditorInputContainer","_renderInputSize","_renderTags","done","_popup","refreshPosition","resolve","fail","reject","promise","_listItemClickHandler","_shouldClearFilter","shouldClearFilter","showSelectionControls","$input","isEmptyInput","width","size","canTypeText","$calculationElement","includePaddings","insertAfter","_renderInputSubstitution","_updateWidgetHeight","_multiTagRequired","values","_renderMultiTag","$tag","multiTagElement","cancel","insertBefore","render","model","container","_getFilter","creator","dataSourceFilter","_dataController","filterExpr","getCombinedFilter","filterQueryLength","encodeURI","JSON","stringify","log","_getFilteredItems","_this$_loadFilteredIt","_this$_list","_loadFilteredItemsPromise","listSelectedItems","isListItemsLoaded","isLoaded","clientFilterFunction","getLocalFilter","_valueGetter","filteredItems","selectedItemsAlreadyLoaded","dataController","_isDataSourceChanged","customQueryParams","expand","select","loadOptions","loadFromStore","extra","_disposed","items","mappedItems","applyMapFunction","_createTagsData","cache","isValueExprSpecified","_valueGetterExpr","filteredValues","forEach","filteredItem","filteredItemValue","loadItemPromises","index","currentItem","_loadItem","always","item","newItem","_createTagData","splice","apply","valueIndex","selectedItem","customItem","_isGroupedData","group","_getItemsByValues","resultItems","_getItemFromPlain","_getFilteredGroupedItems","_filteredGroupedItemsLoadPromise","operationId","load","_loadTagsData","tagData","filteredItemsPromise","isPlainDataUsed","_shouldGetItemsFromPlain","_valuesToUpdate","_getItemsFromPlain","_renderTagsImpl","_renderTagsCore","_renderEmptyState","_getPlainItems","_getSelectedItemsFromList","needFilterPlainItems","plainItems","_filterSelectedItems","_this$_list2","dataItem","currentValue","_isValueEquals","_integrateInput","_isInputReady","tagsContainer","find","_this$_isInputReady","slice","_cleanTags","_renderTagsElements","$multiTag","_renderTag","_refreshTagElements","$tags","_","includes","isEmpty","_toggleEmptiness","_renderDisplayText","_applyTagTemplate","_getTag","displayValue","itemModel","_getItemModel","removeClass","tagId","_createTag","tagsLength","result","closest","hasClass","reset","itemValue","itemId","_removeTagWithUpdate","_updateField","_removeTag","_getCurrentValue","_lastValue","_selectionChangeHandler","removedItems","removedItem","addedItems","addedItem","_addTag","listSelectionChangeEvent","_getSelectionChangeEvent","_saveSelectionChangeEvent","_valueIndex","_fieldRenderData","_completeSelection","_setValue","useButtons","_isSelectedValue","indexByValues","selectedValue","lastValue","_searchHandler","arguments","element","originalHeight","currentHeight","repaint","_refreshSelected","_this$_list3","getDataSource","_resetListDataSourceFilter","_userFilter","reload","valueGetterExpr","_dataSourceFilterExpr","_dataSourceFilterFunction","itemData","_dataSourceChangedHandler","_applyButtonHandler","_getSortedListValues","_cancelSearchIfNeed","listValues","_getListValues","existedItems","newItems","map","_setListDataSource","_renderOpenedState","defaultValue","_clean","_defaultTagTemplate","_getSelectedItemsDifference","previousItems","previousItemsValuesMap","reduce","Object","_optionChanged","previousValue","_initTemplates","_invalidate","_setListOption","_refreshEvents","_selectionChangedAction","_getActualSearchValue","_popupHidingHandler","_clearFilter"],"sources":["C:/Users/Michal Abargel/Desktop/FULLSTACK_PROJECTS/PrivateLessones/PL/client/gui/node_modules/devextreme/esm/ui/tag_box.js"],"sourcesContent":["/**\r\n * DevExtreme (esm/ui/tag_box.js)\r\n * Version: 23.1.5\r\n * Build date: Wed Aug 30 2023\r\n *\r\n * Copyright (c) 2012 - 2023 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport {\r\n    getOuterWidth,\r\n    getHeight\r\n} from \"../core/utils/size\";\r\nimport $ from \"../core/renderer\";\r\nimport devices from \"../core/devices\";\r\nimport {\r\n    data as elementData\r\n} from \"../core/element_data\";\r\nimport eventsEngine from \"../events/core/events_engine\";\r\nimport registerComponent from \"../core/component_registrator\";\r\nimport {\r\n    noop,\r\n    ensureDefined,\r\n    equalByValue\r\n} from \"../core/utils/common\";\r\nimport {\r\n    SelectionFilterCreator as FilterCreator\r\n} from \"../core/utils/selection_filter\";\r\nimport {\r\n    Deferred,\r\n    when\r\n} from \"../core/utils/deferred\";\r\nimport {\r\n    createTextElementHiddenCopy\r\n} from \"../core/utils/dom\";\r\nimport {\r\n    getPublicElement\r\n} from \"../core/element\";\r\nimport {\r\n    isDefined,\r\n    isObject,\r\n    isString\r\n} from \"../core/utils/type\";\r\nimport {\r\n    hasWindow\r\n} from \"../core/utils/window\";\r\nimport {\r\n    extend\r\n} from \"../core/utils/extend\";\r\nimport {\r\n    each\r\n} from \"../core/utils/iterator\";\r\nimport {\r\n    removeDuplicates,\r\n    getIntersection\r\n} from \"../core/utils/array\";\r\nimport messageLocalization from \"../localization/message\";\r\nimport {\r\n    addNamespace,\r\n    isCommandKeyPressed,\r\n    normalizeKeyName\r\n} from \"../events/utils/index\";\r\nimport {\r\n    name as clickEvent\r\n} from \"../events/click\";\r\nimport caret from \"./text_box/utils.caret\";\r\nimport {\r\n    normalizeLoadResult\r\n} from \"../data/data_source/utils\";\r\nimport Guid from \"../core/guid\";\r\nimport SelectBox from \"./select_box\";\r\nimport {\r\n    BindableTemplate\r\n} from \"../core/templates/bindable_template\";\r\nimport {\r\n    allowScroll\r\n} from \"./text_box/utils.scroll\";\r\nimport errors from \"./widget/ui.errors\";\r\nvar TAGBOX_TAG_DATA_KEY = \"dxTagData\";\r\nvar TAGBOX_CLASS = \"dx-tagbox\";\r\nvar TAGBOX_TAG_CONTAINER_CLASS = \"dx-tag-container\";\r\nvar TAGBOX_TAG_CLASS = \"dx-tag\";\r\nvar TAGBOX_MULTI_TAG_CLASS = \"dx-tagbox-multi-tag\";\r\nvar TAGBOX_CUSTOM_TAG_CLASS = \"dx-tag-custom\";\r\nvar TAGBOX_TAG_REMOVE_BUTTON_CLASS = \"dx-tag-remove-button\";\r\nvar TAGBOX_ONLY_SELECT_CLASS = \"dx-tagbox-only-select\";\r\nvar TAGBOX_SINGLE_LINE_CLASS = \"dx-tagbox-single-line\";\r\nvar TAGBOX_POPUP_WRAPPER_CLASS = \"dx-tagbox-popup-wrapper\";\r\nvar TAGBOX_TAG_CONTENT_CLASS = \"dx-tag-content\";\r\nvar TAGBOX_DEFAULT_FIELD_TEMPLATE_CLASS = \"dx-tagbox-default-template\";\r\nvar TAGBOX_CUSTOM_FIELD_TEMPLATE_CLASS = \"dx-tagbox-custom-template\";\r\nvar TEXTEDITOR_INPUT_CONTAINER_CLASS = \"dx-texteditor-input-container\";\r\nvar TAGBOX_MOUSE_WHEEL_DELTA_MULTIPLIER = -.3;\r\nvar TagBox = SelectBox.inherit({\r\n    _supportedKeys: function() {\r\n        var parent = this.callBase();\r\n        var sendToList = options => this._list._keyboardHandler(options);\r\n        var rtlEnabled = this.option(\"rtlEnabled\");\r\n        return extend({}, parent, {\r\n            backspace: function(e) {\r\n                if (!this._isCaretAtTheStart()) {\r\n                    return\r\n                }\r\n                this._processKeyboardEvent(e);\r\n                this._isTagRemoved = true;\r\n                var $tagToDelete = this._$focusedTag || this._tagElements().last();\r\n                if (this._$focusedTag) {\r\n                    this._moveTagFocus(\"prev\", true)\r\n                }\r\n                if (0 === $tagToDelete.length) {\r\n                    return\r\n                }\r\n                this._preserveFocusedTag = true;\r\n                this._removeTagElement($tagToDelete);\r\n                delete this._preserveFocusedTag\r\n            },\r\n            upArrow: (e, opts) => e.altKey || !this._list ? parent.upArrow.call(this, e) : sendToList(opts),\r\n            downArrow: (e, opts) => e.altKey || !this._list ? parent.downArrow.call(this, e) : sendToList(opts),\r\n            del: function(e) {\r\n                if (!this._$focusedTag || !this._isCaretAtTheStart()) {\r\n                    return\r\n                }\r\n                this._processKeyboardEvent(e);\r\n                this._isTagRemoved = true;\r\n                var $tagToDelete = this._$focusedTag;\r\n                this._moveTagFocus(\"next\", true);\r\n                this._preserveFocusedTag = true;\r\n                this._removeTagElement($tagToDelete);\r\n                delete this._preserveFocusedTag\r\n            },\r\n            enter: function(e, options) {\r\n                var isListItemFocused = this._list && null !== this._list.option(\"focusedElement\");\r\n                var isCustomItem = this.option(\"acceptCustomValue\") && !isListItemFocused;\r\n                if (isCustomItem) {\r\n                    e.preventDefault();\r\n                    \"\" !== this._searchValue() && this._customItemAddedHandler(e);\r\n                    return\r\n                }\r\n                if (this.option(\"opened\")) {\r\n                    this._saveValueChangeEvent(e);\r\n                    sendToList(options);\r\n                    e.preventDefault()\r\n                }\r\n            },\r\n            space: function(e, options) {\r\n                var isOpened = this.option(\"opened\");\r\n                var isInputActive = this._shouldRenderSearchEvent();\r\n                if (isOpened && !isInputActive) {\r\n                    this._saveValueChangeEvent(e);\r\n                    sendToList(options);\r\n                    e.preventDefault()\r\n                }\r\n            },\r\n            leftArrow: function(e) {\r\n                if (!this._isCaretAtTheStart() || this._isEmpty() || this._isEditable() && rtlEnabled && !this._$focusedTag) {\r\n                    return\r\n                }\r\n                e.preventDefault();\r\n                var direction = rtlEnabled ? \"next\" : \"prev\";\r\n                this._moveTagFocus(direction);\r\n                !this.option(\"multiline\") && this._scrollContainer(direction)\r\n            },\r\n            rightArrow: function(e) {\r\n                if (!this._isCaretAtTheStart() || this._isEmpty() || this._isEditable() && !rtlEnabled && !this._$focusedTag) {\r\n                    return\r\n                }\r\n                e.preventDefault();\r\n                var direction = rtlEnabled ? \"prev\" : \"next\";\r\n                this._moveTagFocus(direction);\r\n                !this.option(\"multiline\") && this._scrollContainer(direction)\r\n            }\r\n        })\r\n    },\r\n    _processKeyboardEvent: function(e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        this._saveValueChangeEvent(e)\r\n    },\r\n    _isEmpty: function() {\r\n        return 0 === this._getValue().length\r\n    },\r\n    _updateTagsContainer: function($element) {\r\n        this._$tagsContainer = $element.addClass(TAGBOX_TAG_CONTAINER_CLASS)\r\n    },\r\n    _allowSelectItemByTab: function() {\r\n        return false\r\n    },\r\n    _isCaretAtTheStart: function() {\r\n        var position = caret(this._input());\r\n        return 0 === position.start && 0 === position.end\r\n    },\r\n    _updateInputAriaActiveDescendant(id) {\r\n        this.setAria(\"activedescendant\", id, this._input())\r\n    },\r\n    _moveTagFocus: function(direction, clearOnBoundary) {\r\n        if (!this._$focusedTag) {\r\n            var tagElements = this._tagElements();\r\n            this._$focusedTag = \"next\" === direction ? tagElements.first() : tagElements.last();\r\n            this._toggleFocusClass(true, this._$focusedTag);\r\n            this._updateInputAriaActiveDescendant(this._$focusedTag.attr(\"id\"));\r\n            return\r\n        }\r\n        var $nextFocusedTag = this._$focusedTag[direction](\".\".concat(TAGBOX_TAG_CLASS));\r\n        if ($nextFocusedTag.length > 0) {\r\n            this._replaceFocusedTag($nextFocusedTag);\r\n            this._updateInputAriaActiveDescendant($nextFocusedTag.attr(\"id\"))\r\n        } else if (clearOnBoundary || \"next\" === direction && this._isEditable()) {\r\n            this._clearTagFocus();\r\n            this._updateInputAriaActiveDescendant()\r\n        }\r\n    },\r\n    _replaceFocusedTag: function($nextFocusedTag) {\r\n        this._toggleFocusClass(false, this._$focusedTag);\r\n        this._$focusedTag = $nextFocusedTag;\r\n        this._toggleFocusClass(true, this._$focusedTag)\r\n    },\r\n    _clearTagFocus: function() {\r\n        if (!this._$focusedTag) {\r\n            return\r\n        }\r\n        this._toggleFocusClass(false, this._$focusedTag);\r\n        this._updateInputAriaActiveDescendant();\r\n        delete this._$focusedTag\r\n    },\r\n    _focusClassTarget: function($element) {\r\n        if ($element && $element.length && $element[0] !== this._focusTarget()[0]) {\r\n            return $element\r\n        }\r\n        return this.callBase()\r\n    },\r\n    _getLabelContainer: function() {\r\n        return this._$tagsContainer\r\n    },\r\n    _getFieldElement() {\r\n        return this._input()\r\n    },\r\n    _scrollContainer: function(direction) {\r\n        if (this.option(\"multiline\") || !hasWindow()) {\r\n            return\r\n        }\r\n        if (!this._$tagsContainer) {\r\n            return\r\n        }\r\n        var scrollPosition = this._getScrollPosition(direction);\r\n        this._$tagsContainer.scrollLeft(scrollPosition)\r\n    },\r\n    _getScrollPosition: function(direction) {\r\n        if (\"start\" === direction || \"end\" === direction) {\r\n            return this._getBorderPosition(direction)\r\n        }\r\n        return this._$focusedTag ? this._getFocusedTagPosition(direction) : this._getBorderPosition(\"end\")\r\n    },\r\n    _getBorderPosition: function(direction) {\r\n        var rtlEnabled = this.option(\"rtlEnabled\");\r\n        var isScrollLeft = \"end\" === direction ^ rtlEnabled;\r\n        var scrollSign = rtlEnabled ? -1 : 1;\r\n        return isScrollLeft ^ !rtlEnabled ? 0 : scrollSign * (this._$tagsContainer.get(0).scrollWidth - getOuterWidth(this._$tagsContainer))\r\n    },\r\n    _getFocusedTagPosition: function(direction) {\r\n        var rtlEnabled = this.option(\"rtlEnabled\");\r\n        var isScrollLeft = \"next\" === direction ^ rtlEnabled;\r\n        var {\r\n            left: scrollOffset\r\n        } = this._$focusedTag.position();\r\n        var scrollLeft = this._$tagsContainer.scrollLeft();\r\n        if (isScrollLeft) {\r\n            scrollOffset += getOuterWidth(this._$focusedTag, true) - getOuterWidth(this._$tagsContainer)\r\n        }\r\n        if (isScrollLeft ^ scrollOffset < 0) {\r\n            scrollLeft += scrollOffset\r\n        }\r\n        return scrollLeft\r\n    },\r\n    _setNextValue: noop,\r\n    _getDefaultOptions: function() {\r\n        return extend(this.callBase(), {\r\n            value: [],\r\n            showDropDownButton: false,\r\n            maxFilterQueryLength: 1500,\r\n            tagTemplate: \"tag\",\r\n            selectAllText: messageLocalization.format(\"dxList-selectAll\"),\r\n            hideSelectedItems: false,\r\n            selectedItems: [],\r\n            selectAllMode: \"page\",\r\n            onSelectAllValueChanged: null,\r\n            maxDisplayedTags: void 0,\r\n            showMultiTagOnly: true,\r\n            onMultiTagPreparing: null,\r\n            multiline: true,\r\n            useSubmitBehavior: true\r\n        })\r\n    },\r\n    _init: function() {\r\n        this.callBase();\r\n        this._selectedItems = [];\r\n        this._initSelectAllValueChangedAction()\r\n    },\r\n    _initActions: function() {\r\n        this.callBase();\r\n        this._initMultiTagPreparingAction()\r\n    },\r\n    _initMultiTagPreparingAction: function() {\r\n        this._multiTagPreparingAction = this._createActionByOption(\"onMultiTagPreparing\", {\r\n            beforeExecute: function(e) {\r\n                this._multiTagPreparingHandler(e.args[0])\r\n            }.bind(this),\r\n            excludeValidators: [\"disabled\", \"readOnly\"]\r\n        })\r\n    },\r\n    _multiTagPreparingHandler: function(args) {\r\n        var {\r\n            length: selectedCount\r\n        } = this._getValue();\r\n        if (!this.option(\"showMultiTagOnly\")) {\r\n            args.text = messageLocalization.getFormatter(\"dxTagBox-moreSelected\")(selectedCount - this.option(\"maxDisplayedTags\") + 1)\r\n        } else {\r\n            args.text = messageLocalization.getFormatter(\"dxTagBox-selected\")(selectedCount)\r\n        }\r\n    },\r\n    _initDynamicTemplates: function() {\r\n        this.callBase();\r\n        this._templateManager.addDefaultTemplates({\r\n            tag: new BindableTemplate(($container, data) => {\r\n                var _data$text;\r\n                var $tagContent = $(\"<div>\").addClass(TAGBOX_TAG_CONTENT_CLASS);\r\n                $(\"<span>\").text(null !== (_data$text = data.text) && void 0 !== _data$text ? _data$text : data).appendTo($tagContent);\r\n                $(\"<div>\").addClass(TAGBOX_TAG_REMOVE_BUTTON_CLASS).appendTo($tagContent);\r\n                $container.append($tagContent)\r\n            }, [\"text\"], this.option(\"integrationOptions.watchMethod\"), {\r\n                text: this._displayGetter\r\n            })\r\n        })\r\n    },\r\n    _toggleSubmitElement: function(enabled) {\r\n        if (enabled) {\r\n            this._renderSubmitElement();\r\n            this._setSubmitValue()\r\n        } else {\r\n            this._$submitElement && this._$submitElement.remove();\r\n            delete this._$submitElement\r\n        }\r\n    },\r\n    _renderSubmitElement: function() {\r\n        if (!this.option(\"useSubmitBehavior\")) {\r\n            return\r\n        }\r\n        this._$submitElement = $(\"<select>\").attr({\r\n            multiple: \"multiple\",\r\n            \"aria-label\": \"Selected items\"\r\n        }).css(\"display\", \"none\").appendTo(this.$element())\r\n    },\r\n    _setSubmitValue: function() {\r\n        if (!this.option(\"useSubmitBehavior\")) {\r\n            return\r\n        }\r\n        var value = this._getValue();\r\n        var $options = [];\r\n        for (var i = 0, n = value.length; i < n; i++) {\r\n            var useDisplayText = this._shouldUseDisplayValue(value[i]);\r\n            $options.push($(\"<option>\").val(useDisplayText ? this._displayGetter(value[i]) : value[i]).attr(\"selected\", \"selected\"))\r\n        }\r\n        this._getSubmitElement().empty().append($options)\r\n    },\r\n    _initMarkup: function() {\r\n        this._tagElementsCache = $();\r\n        var isSingleLineMode = !this.option(\"multiline\");\r\n        this.$element().addClass(TAGBOX_CLASS).toggleClass(TAGBOX_ONLY_SELECT_CLASS, !(this.option(\"searchEnabled\") || this.option(\"acceptCustomValue\"))).toggleClass(TAGBOX_SINGLE_LINE_CLASS, isSingleLineMode);\r\n        this.setAria({\r\n            role: \"group\",\r\n            roledescription: \"tagbox\"\r\n        }, this.$element());\r\n        this._initTagTemplate();\r\n        this.callBase()\r\n    },\r\n    _getNewLabelId(actualId, newId, shouldRemove) {\r\n        if (!actualId) {\r\n            return newId\r\n        }\r\n        if (shouldRemove) {\r\n            if (actualId === newId) {\r\n                return\r\n            }\r\n            return actualId.split(\" \").filter(id => id !== newId).join(\" \")\r\n        }\r\n        return \"\".concat(actualId, \" \").concat(newId)\r\n    },\r\n    _updateElementAria(id, shouldRemove) {\r\n        var shouldClearLabel = !id;\r\n        if (shouldClearLabel) {\r\n            this.setAria(\"labelledby\", void 0, this.$element());\r\n            return\r\n        }\r\n        var labelId = this.$element().attr(\"aria-labelledby\");\r\n        var newLabelId = this._getNewLabelId(labelId, id, shouldRemove);\r\n        this.setAria(\"labelledby\", newLabelId, this.$element())\r\n    },\r\n    _render: function() {\r\n        this.callBase();\r\n        this._renderTagRemoveAction();\r\n        this._renderSingleLineScroll();\r\n        this._scrollContainer(\"start\")\r\n    },\r\n    _initTagTemplate: function() {\r\n        this._tagTemplate = this._getTemplateByOption(\"tagTemplate\")\r\n    },\r\n    _renderField: function() {\r\n        var isDefaultFieldTemplate = !isDefined(this.option(\"fieldTemplate\"));\r\n        this.$element().toggleClass(TAGBOX_DEFAULT_FIELD_TEMPLATE_CLASS, isDefaultFieldTemplate).toggleClass(TAGBOX_CUSTOM_FIELD_TEMPLATE_CLASS, !isDefaultFieldTemplate);\r\n        this.callBase()\r\n    },\r\n    _renderTagRemoveAction: function() {\r\n        var tagRemoveAction = this._createAction(this._removeTagHandler.bind(this));\r\n        var eventName = addNamespace(clickEvent, \"dxTagBoxTagRemove\");\r\n        eventsEngine.off(this._$tagsContainer, eventName);\r\n        eventsEngine.on(this._$tagsContainer, eventName, \".\".concat(TAGBOX_TAG_REMOVE_BUTTON_CLASS), event => {\r\n            tagRemoveAction({\r\n                event: event\r\n            })\r\n        })\r\n    },\r\n    _renderSingleLineScroll: function() {\r\n        var mouseWheelEvent = addNamespace(\"dxmousewheel\", this.NAME);\r\n        var $element = this.$element();\r\n        var isMultiline = this.option(\"multiline\");\r\n        eventsEngine.off($element, mouseWheelEvent);\r\n        if (\"desktop\" !== devices.real().deviceType) {\r\n            this._$tagsContainer && this._$tagsContainer.css(\"overflowX\", isMultiline ? \"\" : \"auto\");\r\n            return\r\n        }\r\n        if (isMultiline) {\r\n            return\r\n        }\r\n        eventsEngine.on($element, mouseWheelEvent, this._tagContainerMouseWheelHandler.bind(this))\r\n    },\r\n    _tagContainerMouseWheelHandler: function(e) {\r\n        var scrollLeft = this._$tagsContainer.scrollLeft();\r\n        var delta = e.delta * TAGBOX_MOUSE_WHEEL_DELTA_MULTIPLIER;\r\n        if (!isCommandKeyPressed(e) && allowScroll(this._$tagsContainer, delta, true)) {\r\n            this._$tagsContainer.scrollLeft(scrollLeft + delta);\r\n            return false\r\n        }\r\n    },\r\n    _renderEvents: function() {\r\n        this.callBase();\r\n        var input = this._input();\r\n        var namespace = addNamespace(\"keydown\", this.NAME);\r\n        eventsEngine.on(input, namespace, e => {\r\n            var keyName = normalizeKeyName(e);\r\n            if (!this._isControlKey(keyName) && this._isEditable()) {\r\n                this._clearTagFocus()\r\n            }\r\n        })\r\n    },\r\n    _popupWrapperClass: function() {\r\n        return this.callBase() + \" \" + TAGBOX_POPUP_WRAPPER_CLASS\r\n    },\r\n    _renderInput: function() {\r\n        this.callBase();\r\n        this._renderPreventBlurOnInputClick()\r\n    },\r\n    _renderPreventBlurOnInputClick: function() {\r\n        var eventName = addNamespace(\"mousedown\", \"dxTagBox\");\r\n        eventsEngine.off(this._inputWrapper(), eventName);\r\n        eventsEngine.on(this._inputWrapper(), eventName, e => {\r\n            if (e.target !== this._input()[0] && this._isFocused()) {\r\n                e.preventDefault()\r\n            }\r\n        })\r\n    },\r\n    _renderInputValueImpl: function() {\r\n        return this._renderMultiSelect()\r\n    },\r\n    _loadInputValue: function() {\r\n        return when()\r\n    },\r\n    _clearTextValue: function() {\r\n        this._input().val(\"\");\r\n        this._toggleEmptinessEventHandler();\r\n        this.option(\"text\", \"\")\r\n    },\r\n    _focusInHandler: function(e) {\r\n        if (!this._preventNestedFocusEvent(e)) {\r\n            this._scrollContainer(\"end\")\r\n        }\r\n        this.callBase(e)\r\n    },\r\n    _renderInputValue: function() {\r\n        this.option(\"displayValue\", this._searchValue());\r\n        return this.callBase()\r\n    },\r\n    _restoreInputText: function(saveEditingValue) {\r\n        if (!saveEditingValue) {\r\n            this._clearTextValue()\r\n        }\r\n    },\r\n    _focusOutHandler: function(e) {\r\n        if (!this._preventNestedFocusEvent(e)) {\r\n            this._clearTagFocus();\r\n            this._scrollContainer(\"start\")\r\n        }\r\n        this.callBase(e)\r\n    },\r\n    _getFirstPopupElement: function() {\r\n        return this.option(\"showSelectionControls\") ? this._list._focusTarget() : this.callBase()\r\n    },\r\n    _initSelectAllValueChangedAction: function() {\r\n        this._selectAllValueChangeAction = this._createActionByOption(\"onSelectAllValueChanged\")\r\n    },\r\n    _renderList: function() {\r\n        this.callBase();\r\n        this._setListDataSourceFilter();\r\n        if (this.option(\"showSelectionControls\")) {\r\n            this._list.registerKeyHandler(\"tab\", e => this._popupElementTabHandler(e));\r\n            this._list.registerKeyHandler(\"escape\", e => this._popupElementEscHandler(e))\r\n        }\r\n    },\r\n    _canListHaveFocus: function() {\r\n        return \"useButtons\" === this.option(\"applyValueMode\")\r\n    },\r\n    _listConfig: function() {\r\n        var selectionMode = this.option(\"showSelectionControls\") ? \"all\" : \"multiple\";\r\n        return extend(this.callBase(), {\r\n            selectionMode: selectionMode,\r\n            selectAllText: this.option(\"selectAllText\"),\r\n            onSelectAllValueChanged: _ref => {\r\n                var {\r\n                    value: value\r\n                } = _ref;\r\n                this._selectAllValueChangeAction({\r\n                    value: value\r\n                })\r\n            },\r\n            selectAllMode: this.option(\"selectAllMode\"),\r\n            selectedItems: this._selectedItems,\r\n            onFocusedItemChanged: null\r\n        })\r\n    },\r\n    _renderMultiSelect: function() {\r\n        var d = new Deferred;\r\n        this._updateTagsContainer(this._$textEditorInputContainer);\r\n        this._renderInputSize();\r\n        this._renderTags().done(() => {\r\n            this._popup && this._popup.refreshPosition();\r\n            d.resolve()\r\n        }).fail(d.reject);\r\n        return d.promise()\r\n    },\r\n    _listItemClickHandler: function(e) {\r\n        !this.option(\"showSelectionControls\") && this._clearTextValue();\r\n        if (\"useButtons\" === this.option(\"applyValueMode\")) {\r\n            return\r\n        }\r\n        this.callBase(e);\r\n        this._saveValueChangeEvent(void 0)\r\n    },\r\n    _shouldClearFilter: function() {\r\n        var shouldClearFilter = this.callBase();\r\n        var showSelectionControls = this.option(\"showSelectionControls\");\r\n        return !showSelectionControls && shouldClearFilter\r\n    },\r\n    _renderInputSize: function() {\r\n        var $input = this._input();\r\n        var value = $input.val();\r\n        var isEmptyInput = isString(value) && value;\r\n        var width = \"\";\r\n        var size = \"\";\r\n        var canTypeText = this.option(\"searchEnabled\") || this.option(\"acceptCustomValue\");\r\n        if (isEmptyInput && canTypeText) {\r\n            var $calculationElement = createTextElementHiddenCopy($input, value, {\r\n                includePaddings: true\r\n            });\r\n            $calculationElement.insertAfter($input);\r\n            width = getOuterWidth($calculationElement) + 5;\r\n            $calculationElement.remove()\r\n        } else if (!value) {\r\n            size = 1\r\n        }\r\n        $input.css(\"width\", width);\r\n        $input.attr(\"size\", size)\r\n    },\r\n    _renderInputSubstitution: function() {\r\n        this.callBase();\r\n        this._updateWidgetHeight()\r\n    },\r\n    _getValue: function() {\r\n        return this.option(\"value\") || []\r\n    },\r\n    _multiTagRequired: function() {\r\n        var values = this._getValue();\r\n        var maxDisplayedTags = this.option(\"maxDisplayedTags\");\r\n        return isDefined(maxDisplayedTags) && values.length > maxDisplayedTags\r\n    },\r\n    _renderMultiTag: function($input) {\r\n        var $tag = $(\"<div>\").addClass(TAGBOX_TAG_CLASS).addClass(TAGBOX_MULTI_TAG_CLASS);\r\n        var args = {\r\n            multiTagElement: getPublicElement($tag),\r\n            selectedItems: this.option(\"selectedItems\")\r\n        };\r\n        this._multiTagPreparingAction(args);\r\n        if (args.cancel) {\r\n            return false\r\n        }\r\n        $tag.data(TAGBOX_TAG_DATA_KEY, args.text);\r\n        $tag.insertBefore($input);\r\n        this._tagTemplate.render({\r\n            model: args.text,\r\n            container: getPublicElement($tag)\r\n        });\r\n        return $tag\r\n    },\r\n    _getFilter: function(creator) {\r\n        var dataSourceFilter = this._dataController.filter();\r\n        var filterExpr = creator.getCombinedFilter(this.option(\"valueExpr\"), dataSourceFilter);\r\n        var filterQueryLength = encodeURI(JSON.stringify(filterExpr)).length;\r\n        var maxFilterQueryLength = this.option(\"maxFilterQueryLength\");\r\n        if (filterQueryLength <= maxFilterQueryLength) {\r\n            return filterExpr\r\n        }\r\n        errors.log(\"W1019\", maxFilterQueryLength)\r\n    },\r\n    _getFilteredItems: function(values) {\r\n        var _this$_loadFilteredIt, _this$_list;\r\n        null === (_this$_loadFilteredIt = this._loadFilteredItemsPromise) || void 0 === _this$_loadFilteredIt ? void 0 : _this$_loadFilteredIt.reject();\r\n        var creator = new FilterCreator(values);\r\n        var listSelectedItems = null === (_this$_list = this._list) || void 0 === _this$_list ? void 0 : _this$_list.option(\"selectedItems\");\r\n        var isListItemsLoaded = !!listSelectedItems && this._list._dataController.isLoaded();\r\n        var selectedItems = listSelectedItems || this.option(\"selectedItems\");\r\n        var clientFilterFunction = creator.getLocalFilter(this._valueGetter);\r\n        var filteredItems = selectedItems.filter(clientFilterFunction);\r\n        var selectedItemsAlreadyLoaded = filteredItems.length === values.length;\r\n        var d = new Deferred;\r\n        var dataController = this._dataController;\r\n        if ((!this._isDataSourceChanged || isListItemsLoaded) && selectedItemsAlreadyLoaded) {\r\n            return d.resolve(filteredItems).promise()\r\n        } else {\r\n            var {\r\n                customQueryParams: customQueryParams,\r\n                expand: expand,\r\n                select: select\r\n            } = dataController.loadOptions();\r\n            var filter = this._getFilter(creator);\r\n            dataController.loadFromStore({\r\n                filter: filter,\r\n                customQueryParams: customQueryParams,\r\n                expand: expand,\r\n                select: select\r\n            }).done((data, extra) => {\r\n                this._isDataSourceChanged = false;\r\n                if (this._disposed) {\r\n                    d.reject();\r\n                    return\r\n                }\r\n                var {\r\n                    data: items\r\n                } = normalizeLoadResult(data, extra);\r\n                var mappedItems = dataController.applyMapFunction(items);\r\n                d.resolve(mappedItems.filter(clientFilterFunction))\r\n            }).fail(d.reject);\r\n            this._loadFilteredItemsPromise = d;\r\n            return d.promise()\r\n        }\r\n    },\r\n    _createTagsData: function(values, filteredItems) {\r\n        var items = [];\r\n        var cache = {};\r\n        var isValueExprSpecified = \"this\" === this._valueGetterExpr();\r\n        var filteredValues = {};\r\n        filteredItems.forEach(filteredItem => {\r\n            var filteredItemValue = isValueExprSpecified ? JSON.stringify(filteredItem) : this._valueGetter(filteredItem);\r\n            filteredValues[filteredItemValue] = filteredItem\r\n        });\r\n        var loadItemPromises = [];\r\n        values.forEach((value, index) => {\r\n            var currentItem = filteredValues[isValueExprSpecified ? JSON.stringify(value) : value];\r\n            if (isValueExprSpecified && !isDefined(currentItem)) {\r\n                loadItemPromises.push(this._loadItem(value, cache).always(item => {\r\n                    var newItem = this._createTagData(items, item, value, index);\r\n                    items.splice(index, 0, newItem)\r\n                }))\r\n            } else {\r\n                var newItem = this._createTagData(items, currentItem, value, index);\r\n                items.splice(index, 0, newItem)\r\n            }\r\n        });\r\n        var d = new Deferred;\r\n        when.apply(this, loadItemPromises).always((function() {\r\n            d.resolve(items)\r\n        }));\r\n        return d.promise()\r\n    },\r\n    _createTagData: function(items, item, value, valueIndex) {\r\n        if (isDefined(item)) {\r\n            this._selectedItems.push(item);\r\n            return item\r\n        } else {\r\n            var selectedItem = this.option(\"selectedItem\");\r\n            var customItem = this._valueGetter(selectedItem) === value ? selectedItem : value;\r\n            return customItem\r\n        }\r\n    },\r\n    _isGroupedData: function() {\r\n        return this.option(\"grouped\") && !this._dataController.group()\r\n    },\r\n    _getItemsByValues: function(values) {\r\n        var resultItems = [];\r\n        values.forEach(function(value) {\r\n            var item = this._getItemFromPlain(value);\r\n            if (isDefined(item)) {\r\n                resultItems.push(item)\r\n            }\r\n        }.bind(this));\r\n        return resultItems\r\n    },\r\n    _getFilteredGroupedItems: function(values) {\r\n        var selectedItems = new Deferred;\r\n        if (this._filteredGroupedItemsLoadPromise) {\r\n            this._dataController.cancel(this._filteredGroupedItemsLoadPromise.operationId)\r\n        }\r\n        if (!this._dataController.items().length) {\r\n            this._filteredGroupedItemsLoadPromise = this._dataController.load().done(() => {\r\n                selectedItems.resolve(this._getItemsByValues(values))\r\n            }).fail(() => {\r\n                selectedItems.resolve([])\r\n            }).always(() => {\r\n                this._filteredGroupedItemsLoadPromise = void 0\r\n            })\r\n        } else {\r\n            selectedItems.resolve(this._getItemsByValues(values))\r\n        }\r\n        return selectedItems.promise()\r\n    },\r\n    _loadTagsData: function() {\r\n        var values = this._getValue();\r\n        var tagData = new Deferred;\r\n        this._selectedItems = [];\r\n        var filteredItemsPromise = this._isGroupedData() ? this._getFilteredGroupedItems(values) : this._getFilteredItems(values);\r\n        filteredItemsPromise.done(filteredItems => {\r\n            var items = this._createTagsData(values, filteredItems);\r\n            items.always((function(data) {\r\n                tagData.resolve(data)\r\n            }))\r\n        }).fail(tagData.reject.bind(this));\r\n        return tagData.promise()\r\n    },\r\n    _renderTags: function() {\r\n        var d = new Deferred;\r\n        var isPlainDataUsed = false;\r\n        if (this._shouldGetItemsFromPlain(this._valuesToUpdate)) {\r\n            this._selectedItems = this._getItemsFromPlain(this._valuesToUpdate);\r\n            if (this._selectedItems.length === this._valuesToUpdate.length) {\r\n                this._renderTagsImpl(this._selectedItems);\r\n                isPlainDataUsed = true;\r\n                d.resolve()\r\n            }\r\n        }\r\n        if (!isPlainDataUsed) {\r\n            this._loadTagsData().done(items => {\r\n                if (this._disposed) {\r\n                    d.reject();\r\n                    return\r\n                }\r\n                this._renderTagsImpl(items);\r\n                d.resolve()\r\n            }).fail(d.reject)\r\n        }\r\n        return d.promise()\r\n    },\r\n    _renderTagsImpl: function(items) {\r\n        this._renderTagsCore(items);\r\n        this._renderEmptyState();\r\n        if (!this._preserveFocusedTag) {\r\n            this._clearTagFocus()\r\n        }\r\n    },\r\n    _shouldGetItemsFromPlain: function(values) {\r\n        return values && this._dataController.isLoaded() && values.length <= this._getPlainItems().length\r\n    },\r\n    _getItemsFromPlain: function(values) {\r\n        var selectedItems = this._getSelectedItemsFromList(values);\r\n        var needFilterPlainItems = 0 === selectedItems.length && values.length > 0 || selectedItems.length < values.length;\r\n        if (needFilterPlainItems) {\r\n            var plainItems = this._getPlainItems();\r\n            selectedItems = this._filterSelectedItems(plainItems, values)\r\n        }\r\n        return selectedItems\r\n    },\r\n    _getSelectedItemsFromList: function(values) {\r\n        var _this$_list2;\r\n        var listSelectedItems = null === (_this$_list2 = this._list) || void 0 === _this$_list2 ? void 0 : _this$_list2.option(\"selectedItems\");\r\n        var selectedItems = [];\r\n        if (values.length === (null === listSelectedItems || void 0 === listSelectedItems ? void 0 : listSelectedItems.length)) {\r\n            selectedItems = this._filterSelectedItems(listSelectedItems, values)\r\n        }\r\n        return selectedItems\r\n    },\r\n    _filterSelectedItems: function(plainItems, values) {\r\n        var selectedItems = plainItems.filter(dataItem => {\r\n            var currentValue;\r\n            for (var i = 0; i < values.length; i++) {\r\n                currentValue = values[i];\r\n                if (isObject(currentValue)) {\r\n                    if (this._isValueEquals(dataItem, currentValue)) {\r\n                        return true\r\n                    }\r\n                } else if (this._isValueEquals(this._valueGetter(dataItem), currentValue)) {\r\n                    return true\r\n                }\r\n            }\r\n            return false\r\n        }, this);\r\n        return selectedItems\r\n    },\r\n    _integrateInput: function() {\r\n        this._isInputReady.resolve();\r\n        this.callBase();\r\n        var tagsContainer = this.$element().find(\".\".concat(TEXTEDITOR_INPUT_CONTAINER_CLASS));\r\n        this._updateTagsContainer(tagsContainer);\r\n        this._renderTagRemoveAction()\r\n    },\r\n    _renderTagsCore: function(items) {\r\n        var _this$_isInputReady;\r\n        null === (_this$_isInputReady = this._isInputReady) || void 0 === _this$_isInputReady ? void 0 : _this$_isInputReady.reject();\r\n        this._isInputReady = new Deferred;\r\n        this._renderField();\r\n        this.option(\"selectedItems\", this._selectedItems.slice());\r\n        this._cleanTags();\r\n        if (this._input().length > 0) {\r\n            this._isInputReady.resolve()\r\n        }\r\n        when(this._isInputReady).done(() => {\r\n            this._renderTagsElements(items)\r\n        })\r\n    },\r\n    _renderTagsElements(items) {\r\n        var $multiTag = this._multiTagRequired() && this._renderMultiTag(this._input());\r\n        var showMultiTagOnly = this.option(\"showMultiTagOnly\");\r\n        var maxDisplayedTags = this.option(\"maxDisplayedTags\");\r\n        items.forEach((item, index) => {\r\n            if ($multiTag && showMultiTagOnly || $multiTag && !showMultiTagOnly && index - maxDisplayedTags >= -1) {\r\n                return false\r\n            }\r\n            this._renderTag(item, $multiTag || this._input())\r\n        });\r\n        if (this._isFocused()) {\r\n            this._scrollContainer(\"end\")\r\n        }\r\n        this._refreshTagElements()\r\n    },\r\n    _cleanTags: function() {\r\n        if (this._multiTagRequired()) {\r\n            this._tagElements().remove()\r\n        } else {\r\n            var $tags = this._tagElements();\r\n            var values = this._getValue();\r\n            each($tags, (function(_, tag) {\r\n                var $tag = $(tag);\r\n                var tagData = $tag.data(TAGBOX_TAG_DATA_KEY);\r\n                if (!(null !== values && void 0 !== values && values.includes(tagData))) {\r\n                    $tag.remove()\r\n                }\r\n            }))\r\n        }\r\n        this._updateElementAria()\r\n    },\r\n    _renderEmptyState: function() {\r\n        var isEmpty = !(this._getValue().length || this._selectedItems.length || this._searchValue());\r\n        this._toggleEmptiness(isEmpty);\r\n        this._renderDisplayText()\r\n    },\r\n    _renderDisplayText: function() {\r\n        this._renderInputSize()\r\n    },\r\n    _refreshTagElements: function() {\r\n        this._tagElementsCache = this.$element().find(\".\".concat(TAGBOX_TAG_CLASS))\r\n    },\r\n    _tagElements: function() {\r\n        return this._tagElementsCache\r\n    },\r\n    _applyTagTemplate: function(item, $tag) {\r\n        this._tagTemplate.render({\r\n            model: item,\r\n            container: getPublicElement($tag)\r\n        })\r\n    },\r\n    _renderTag: function(item, $input) {\r\n        var value = this._valueGetter(item);\r\n        if (!isDefined(value)) {\r\n            return\r\n        }\r\n        var $tag = this._getTag(value);\r\n        var displayValue = this._displayGetter(item);\r\n        var itemModel = this._getItemModel(item, displayValue);\r\n        if ($tag) {\r\n            if (isDefined(displayValue)) {\r\n                $tag.empty();\r\n                this._applyTagTemplate(itemModel, $tag)\r\n            }\r\n            $tag.removeClass(TAGBOX_CUSTOM_TAG_CLASS);\r\n            this._updateElementAria($tag.attr(\"id\"))\r\n        } else {\r\n            var tagId = \"dx-\".concat(new Guid);\r\n            $tag = this._createTag(value, $input, tagId);\r\n            if (isDefined(item)) {\r\n                this._applyTagTemplate(itemModel, $tag)\r\n            } else {\r\n                $tag.addClass(TAGBOX_CUSTOM_TAG_CLASS);\r\n                this._applyTagTemplate(value, $tag)\r\n            }\r\n            this._updateElementAria(tagId)\r\n        }\r\n    },\r\n    _getItemModel: function(item, displayValue) {\r\n        if (isObject(item) && isDefined(displayValue)) {\r\n            return item\r\n        } else {\r\n            return ensureDefined(displayValue, \"\")\r\n        }\r\n    },\r\n    _getTag: function(value) {\r\n        var $tags = this._tagElements();\r\n        var tagsLength = $tags.length;\r\n        var result = false;\r\n        for (var i = 0; i < tagsLength; i++) {\r\n            var $tag = $tags[i];\r\n            var tagData = elementData($tag, TAGBOX_TAG_DATA_KEY);\r\n            if (value === tagData || equalByValue(value, tagData)) {\r\n                result = $($tag);\r\n                break\r\n            }\r\n        }\r\n        return result\r\n    },\r\n    _createTag: function(value, $input, tagId) {\r\n        return $(\"<div>\").attr(\"id\", tagId).addClass(TAGBOX_TAG_CLASS).data(TAGBOX_TAG_DATA_KEY, value).insertBefore($input)\r\n    },\r\n    _toggleEmptinessEventHandler: function() {\r\n        this._toggleEmptiness(!this._getValue().length && !this._searchValue().length)\r\n    },\r\n    _customItemAddedHandler: function(e) {\r\n        this.callBase(e);\r\n        this._clearTextValue()\r\n    },\r\n    _removeTagHandler: function(args) {\r\n        var e = args.event;\r\n        e.stopPropagation();\r\n        this._saveValueChangeEvent(e);\r\n        var $tag = $(e.target).closest(\".\".concat(TAGBOX_TAG_CLASS));\r\n        this._removeTagElement($tag)\r\n    },\r\n    _removeTagElement: function($tag) {\r\n        if ($tag.hasClass(TAGBOX_MULTI_TAG_CLASS)) {\r\n            if (!this.option(\"showMultiTagOnly\")) {\r\n                this.option(\"value\", this._getValue().slice(0, this.option(\"maxDisplayedTags\")))\r\n            } else {\r\n                this.reset()\r\n            }\r\n            return\r\n        }\r\n        var itemValue = $tag.data(TAGBOX_TAG_DATA_KEY);\r\n        var itemId = $tag.attr(\"id\");\r\n        this._removeTagWithUpdate(itemValue);\r\n        this._updateElementAria(itemId, true);\r\n        this._refreshTagElements()\r\n    },\r\n    _updateField: noop,\r\n    _removeTagWithUpdate: function(itemValue) {\r\n        var value = this._getValue().slice();\r\n        this._removeTag(value, itemValue);\r\n        this.option(\"value\", value);\r\n        if (0 === value.length) {\r\n            this._clearTagFocus()\r\n        }\r\n    },\r\n    _getCurrentValue: function() {\r\n        return this._lastValue()\r\n    },\r\n    _selectionChangeHandler: function(e) {\r\n        if (\"useButtons\" === this.option(\"applyValueMode\")) {\r\n            return\r\n        }\r\n        var value = this._getValue().slice();\r\n        each(e.removedItems || [], (_, removedItem) => {\r\n            this._removeTag(value, this._valueGetter(removedItem))\r\n        });\r\n        each(e.addedItems || [], (_, addedItem) => {\r\n            this._addTag(value, this._valueGetter(addedItem))\r\n        });\r\n        this._updateWidgetHeight();\r\n        if (!equalByValue(this._list.option(\"selectedItemKeys\"), this.option(\"value\"))) {\r\n            var listSelectionChangeEvent = this._list._getSelectionChangeEvent();\r\n            listSelectionChangeEvent && this._saveValueChangeEvent(listSelectionChangeEvent);\r\n            this.option(\"value\", value)\r\n        }\r\n        this._list._saveSelectionChangeEvent(void 0)\r\n    },\r\n    _removeTag: function(value, item) {\r\n        var index = this._valueIndex(item, value);\r\n        if (index >= 0) {\r\n            value.splice(index, 1)\r\n        }\r\n    },\r\n    _addTag: function(value, item) {\r\n        var index = this._valueIndex(item);\r\n        if (index < 0) {\r\n            value.push(item)\r\n        }\r\n    },\r\n    _fieldRenderData: function() {\r\n        return this._selectedItems.slice()\r\n    },\r\n    _completeSelection: function(value) {\r\n        if (!this.option(\"showSelectionControls\")) {\r\n            this._setValue(value)\r\n        }\r\n    },\r\n    _setValue: function(value) {\r\n        if (null === value) {\r\n            return\r\n        }\r\n        var useButtons = \"useButtons\" === this.option(\"applyValueMode\");\r\n        var valueIndex = this._valueIndex(value);\r\n        var values = (useButtons ? this._list.option(\"selectedItemKeys\") : this._getValue()).slice();\r\n        if (valueIndex >= 0) {\r\n            values.splice(valueIndex, 1)\r\n        } else {\r\n            values.push(value)\r\n        }\r\n        if (\"useButtons\" === this.option(\"applyValueMode\")) {\r\n            this._list.option(\"selectedItemKeys\", values)\r\n        } else {\r\n            this.option(\"value\", values)\r\n        }\r\n    },\r\n    _isSelectedValue: function(value, cache) {\r\n        return this._valueIndex(value, null, cache) > -1\r\n    },\r\n    _valueIndex: function(value, values, cache) {\r\n        var result = -1;\r\n        if (cache && \"object\" !== typeof value) {\r\n            if (!cache.indexByValues) {\r\n                cache.indexByValues = {};\r\n                values = values || this._getValue();\r\n                values.forEach((function(value, index) {\r\n                    cache.indexByValues[value] = index\r\n                }))\r\n            }\r\n            if (value in cache.indexByValues) {\r\n                return cache.indexByValues[value]\r\n            }\r\n        }\r\n        values = values || this._getValue();\r\n        each(values, (index, selectedValue) => {\r\n            if (this._isValueEquals(value, selectedValue)) {\r\n                result = index;\r\n                return false\r\n            }\r\n        });\r\n        return result\r\n    },\r\n    _lastValue: function() {\r\n        var values = this._getValue();\r\n        var lastValue = values[values.length - 1];\r\n        return null !== lastValue && void 0 !== lastValue ? lastValue : null\r\n    },\r\n    _shouldRenderSearchEvent: function() {\r\n        return this.option(\"searchEnabled\") || this.option(\"acceptCustomValue\")\r\n    },\r\n    _searchHandler: function(e) {\r\n        if (this.option(\"searchEnabled\") && !!e && !this._isTagRemoved) {\r\n            this.callBase(arguments);\r\n            this._setListDataSourceFilter()\r\n        }\r\n        this._updateWidgetHeight();\r\n        delete this._isTagRemoved\r\n    },\r\n    _updateWidgetHeight: function() {\r\n        var element = this.$element();\r\n        var originalHeight = getHeight(element);\r\n        this._renderInputSize();\r\n        var currentHeight = getHeight(element);\r\n        if (this._popup && this.option(\"opened\") && this._isEditable() && currentHeight !== originalHeight) {\r\n            this._popup.repaint()\r\n        }\r\n    },\r\n    _refreshSelected: function() {\r\n        var _this$_list3;\r\n        (null === (_this$_list3 = this._list) || void 0 === _this$_list3 ? void 0 : _this$_list3.getDataSource()) && this._list.option(\"selectedItems\", this._selectedItems)\r\n    },\r\n    _resetListDataSourceFilter: function() {\r\n        var dataController = this._dataController;\r\n        delete this._userFilter;\r\n        dataController.filter(null);\r\n        dataController.reload()\r\n    },\r\n    _setListDataSourceFilter: function() {\r\n        if (!this.option(\"hideSelectedItems\") || !this._list) {\r\n            return\r\n        }\r\n        var dataController = this._dataController;\r\n        var valueGetterExpr = this._valueGetterExpr();\r\n        if (isString(valueGetterExpr) && \"this\" !== valueGetterExpr) {\r\n            var filter = this._dataSourceFilterExpr();\r\n            if (void 0 === this._userFilter) {\r\n                this._userFilter = dataController.filter() || null\r\n            }\r\n            this._userFilter && filter.push(this._userFilter);\r\n            filter.length ? dataController.filter(filter) : dataController.filter(null)\r\n        } else {\r\n            dataController.filter(this._dataSourceFilterFunction.bind(this))\r\n        }\r\n        dataController.load()\r\n    },\r\n    _dataSourceFilterExpr: function() {\r\n        var filter = [];\r\n        this._getValue().forEach(value => filter.push([\"!\", [this._valueGetterExpr(), value]]));\r\n        return filter\r\n    },\r\n    _dataSourceFilterFunction: function(itemData) {\r\n        var itemValue = this._valueGetter(itemData);\r\n        var result = true;\r\n        each(this._getValue(), (index, value) => {\r\n            if (this._isValueEquals(value, itemValue)) {\r\n                result = false;\r\n                return false\r\n            }\r\n        });\r\n        return result\r\n    },\r\n    _dataSourceChangedHandler: function() {\r\n        this._isDataSourceChanged = true;\r\n        this.callBase.apply(this, arguments)\r\n    },\r\n    _applyButtonHandler: function(args) {\r\n        this._saveValueChangeEvent(args.event);\r\n        this.option(\"value\", this._getSortedListValues());\r\n        this._clearTextValue();\r\n        this.callBase();\r\n        this._cancelSearchIfNeed()\r\n    },\r\n    _getSortedListValues: function() {\r\n        var listValues = this._getListValues();\r\n        var currentValue = this.option(\"value\") || [];\r\n        var existedItems = listValues.length ? getIntersection(currentValue, listValues) : [];\r\n        var newItems = existedItems.length ? removeDuplicates(listValues, currentValue) : listValues;\r\n        return existedItems.concat(newItems)\r\n    },\r\n    _getListValues: function() {\r\n        if (!this._list) {\r\n            return []\r\n        }\r\n        return this._getPlainItems(this._list.option(\"selectedItems\")).map(item => this._valueGetter(item))\r\n    },\r\n    _setListDataSource: function() {\r\n        var currentValue = this._getValue();\r\n        this.callBase();\r\n        if (currentValue !== this.option(\"value\")) {\r\n            this.option(\"value\", currentValue)\r\n        }\r\n        this._refreshSelected()\r\n    },\r\n    _renderOpenedState: function() {\r\n        this.callBase();\r\n        if (\"useButtons\" === this.option(\"applyValueMode\") && !this.option(\"opened\")) {\r\n            this._refreshSelected()\r\n        }\r\n    },\r\n    reset: function() {\r\n        this._restoreInputText();\r\n        var defaultValue = this._getDefaultOptions().value;\r\n        var currentValue = this.option(\"value\");\r\n        if (defaultValue && 0 === defaultValue.length && currentValue && defaultValue.length === currentValue.length) {\r\n            return\r\n        }\r\n        this.callBase()\r\n    },\r\n    _clean: function() {\r\n        this.callBase();\r\n        delete this._defaultTagTemplate;\r\n        delete this._valuesToUpdate;\r\n        delete this._tagTemplate\r\n    },\r\n    _getSelectedItemsDifference(newItems, previousItems) {\r\n        if (!newItems.length) {\r\n            return {\r\n                addedItems: [],\r\n                removedItems: previousItems.slice()\r\n            }\r\n        }\r\n        if (!previousItems.length) {\r\n            return {\r\n                addedItems: newItems.slice(),\r\n                removedItems: []\r\n            }\r\n        }\r\n        var previousItemsValuesMap = previousItems.reduce((map, item) => {\r\n            var value = this._valueGetter(item);\r\n            map[value] = item;\r\n            return map\r\n        }, {});\r\n        var addedItems = [];\r\n        newItems.forEach(item => {\r\n            var value = this._valueGetter(item);\r\n            if (!previousItemsValuesMap[value]) {\r\n                addedItems.push(item)\r\n            }\r\n            delete previousItemsValuesMap[value]\r\n        });\r\n        return {\r\n            addedItems: addedItems,\r\n            removedItems: Object.values(previousItemsValuesMap)\r\n        }\r\n    },\r\n    _optionChanged: function(args) {\r\n        var {\r\n            name: name,\r\n            value: value,\r\n            previousValue: previousValue\r\n        } = args;\r\n        switch (name) {\r\n            case \"onSelectAllValueChanged\":\r\n                this._initSelectAllValueChangedAction();\r\n                break;\r\n            case \"onMultiTagPreparing\":\r\n                this._initMultiTagPreparingAction();\r\n                this._renderTags();\r\n                break;\r\n            case \"hideSelectedItems\":\r\n                if (value) {\r\n                    this._setListDataSourceFilter()\r\n                } else {\r\n                    this._resetListDataSourceFilter()\r\n                }\r\n                break;\r\n            case \"useSubmitBehavior\":\r\n                this._toggleSubmitElement(value);\r\n                break;\r\n            case \"displayExpr\":\r\n                this.callBase(args);\r\n                this._initTemplates();\r\n                this._invalidate();\r\n                break;\r\n            case \"tagTemplate\":\r\n                this._initTagTemplate();\r\n                this._invalidate();\r\n                break;\r\n            case \"selectAllText\":\r\n                this._setListOption(\"selectAllText\", this.option(\"selectAllText\"));\r\n                break;\r\n            case \"readOnly\":\r\n            case \"disabled\":\r\n                this.callBase(args);\r\n                !value && this._refreshEvents();\r\n                break;\r\n            case \"value\":\r\n                this._valuesToUpdate = value;\r\n                this.callBase(args);\r\n                this._valuesToUpdate = void 0;\r\n                this._setListDataSourceFilter();\r\n                break;\r\n            case \"maxDisplayedTags\":\r\n            case \"showMultiTagOnly\":\r\n                this._renderTags();\r\n                break;\r\n            case \"selectAllMode\":\r\n                this._setListOption(name, value);\r\n                break;\r\n            case \"selectedItem\":\r\n                break;\r\n            case \"selectedItems\":\r\n                this._selectionChangedAction(this._getSelectedItemsDifference(value, previousValue));\r\n                break;\r\n            case \"multiline\":\r\n                this.$element().toggleClass(TAGBOX_SINGLE_LINE_CLASS, !value);\r\n                this._renderSingleLineScroll();\r\n                break;\r\n            case \"maxFilterQueryLength\":\r\n                break;\r\n            default:\r\n                this.callBase(args)\r\n        }\r\n    },\r\n    _getActualSearchValue: function() {\r\n        return this.callBase() || this._searchValue()\r\n    },\r\n    _popupHidingHandler: function() {\r\n        this.callBase();\r\n        this._clearFilter()\r\n    }\r\n});\r\nregisterComponent(\"dxTagBox\", TagBox);\r\nexport default TagBox;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}